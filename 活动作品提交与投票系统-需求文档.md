# æ´»åŠ¨ä½œå“æäº¤ä¸æŠ•ç¥¨ç³»ç»Ÿ - éœ€æ±‚æ–‡æ¡£ (PRD)

**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-12
**çŠ¶æ€**: å¾…å¼€å‘

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
3. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
4. [é¡µé¢ç»“æ„ä¸è·¯ç”±](#é¡µé¢ç»“æ„ä¸è·¯ç”±)
5. [åŠŸèƒ½è¯¦ç»†è¯´æ˜](#åŠŸèƒ½è¯¦ç»†è¯´æ˜)
6. [æŠ€æœ¯å®ç°è¦ç‚¹](#æŠ€æœ¯å®ç°è¦ç‚¹)
7. [å¼€å‘ä¼˜å…ˆçº§](#å¼€å‘ä¼˜å…ˆçº§)

---

## é¡¹ç›®æ¦‚è¿°

### ä¸šåŠ¡èƒŒæ™¯
ç¤¾åŒºä¸¾åŠå„ç±»æ´»åŠ¨ï¼ˆå¦‚ Mini Project Hackï¼‰ï¼Œéœ€è¦å‚ä¸è€…æäº¤ä½œå“å¹¶è¿›è¡Œç°åœºæŠ•ç¥¨è¯„é€‰ã€‚æœ¬ç³»ç»Ÿæ—¨åœ¨æä¾›ä¸€ä¸ªä¾¿æ·çš„ä½œå“æäº¤ã€å±•ç¤ºå’ŒæŠ•ç¥¨å¹³å°ã€‚

### ç›®æ ‡ç”¨æˆ·
- **æ´»åŠ¨å‚ä¸è€…ï¼ˆæŠ¥åè€…ï¼‰**: æäº¤ä½œå“ã€ç»„å»ºå›¢é˜Ÿã€æŠ•ç¥¨
- **æ´»åŠ¨ç»„ç»‡è€…**: æŸ¥çœ‹ä½œå“ã€ç®¡ç†æŠ•ç¥¨
- **æ™®é€šè®¿å®¢**: æµè§ˆä½œå“å±•ç¤º

### æ ¸å¿ƒä»·å€¼
- è§„èŒƒåŒ–ä½œå“æäº¤æµç¨‹
- å®æ—¶å±•ç¤ºä½œå“å’ŒæŠ•ç¥¨ç»“æœ
- å¢å¼ºæ´»åŠ¨ç°åœºäº’åŠ¨æ€§
- æ–¹ä¾¿åç»­ä½œå“å½’æ¡£å’Œå¤ç›˜

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. ä½œå“æäº¤
- âœ… æ´»åŠ¨æŠ¥åè€…å¯æäº¤å¤šä¸ªä½œå“
- âœ… æ¯ä¸ªä½œå“å…³è”åˆ°å…·ä½“æ´»åŠ¨ï¼ˆEventï¼‰
- âœ… ä½œå“æäº¤åç«‹å³å¯è§ï¼Œæ— éœ€å®¡æ ¸
- âœ… æ´»åŠ¨å¼€å§‹å‰å³å¯æäº¤ä½œå“
- âœ… ä½œå“å¯éšæ—¶ä¿®æ”¹ï¼ˆæ— æˆªæ­¢æ—¶é—´é™åˆ¶ï¼‰
- âœ… è¡¨å•ç¼“å­˜ï¼šé˜²æ­¢ç”¨æˆ·é€€å‡ºæ—¶æ•°æ®ä¸¢å¤±

### 2. å›¢é˜Ÿç®¡ç†
- âœ… é˜Ÿé•¿ï¼šé»˜è®¤ä¸ºä½œå“åˆ›å»ºè€…ï¼ˆæŠ¥åè€…æœ¬äººï¼‰ï¼Œå¯æŒ‡å®šå…¶ä»–äººä¸ºé˜Ÿé•¿
- âœ… é˜Ÿå‘˜ï¼šå¯æœç´¢å…¨å±€æ³¨å†Œç”¨æˆ·ï¼Œæœ€å¤š 10 äºº
- âœ… é˜Ÿå‘˜ç®¡ç†æƒé™ï¼šä»…é˜Ÿé•¿å¯ç¼–è¾‘ä½œå“ä¿¡æ¯å’Œå›¢é˜Ÿæˆå‘˜
- âœ… ä½¿ç”¨ç°æœ‰çš„ `ProjectMember` æ¨¡å‹å­˜å‚¨å›¢é˜Ÿ

### 3. ä½œå“ä¿¡æ¯å­—æ®µ

#### å¿…å¡«å­—æ®µ
- **ä½œå“åç§°** (name): 1-50 å­—ç¬¦
- **ä¸€å¥è¯ä»‹ç»** (tagline): 10-100 å­—ç¬¦
- **æ˜¯å¦æˆæƒç¤¾åŒºå®£ä¼ ä½¿ç”¨** (communityUseAuthorization): å¸ƒå°”å€¼ï¼ˆæ˜¯/å¦ï¼‰

#### å¯é€‰å­—æ®µ
- **è¯¦ç»†æè¿°** (description): æœ€å¤š 5000 å­—ç¬¦ï¼Œæ”¯æŒå¯Œæ–‡æœ¬
- **é¡¹ç›®ç½‘å€** (demoUrl): URL æ ¼å¼
- **é™„ä»¶** (attachments):
  - ç±»å‹ï¼šå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡ä»¶ï¼ˆæ— ç±»å‹é™åˆ¶ï¼‰
  - æ•°é‡ï¼šä¸é™
  - å•ä¸ªæ–‡ä»¶å¤§å°ï¼šæœ€å¤§ 200MB
  - å­˜å‚¨ï¼šä¸Šä¼ åˆ° COSï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰

#### é¢„ç•™å­—æ®µï¼ˆæœªæ¥æ‰©å±•ï¼‰
- **è‡ªå®šä¹‰å­—æ®µ** (customFields): JSON æ ¼å¼
  - ä¸åŒæ´»åŠ¨å¯å®šä¹‰ä¸åŒçš„å­—æ®µ
  - ç¬¬ä¸€ç‰ˆæœ¬å…ˆé¢„ç•™æ•°æ®åº“å­—æ®µï¼ŒUI æš‚ä¸å®ç°

### 4. æŠ•ç¥¨åŠŸèƒ½

#### æŠ•ç¥¨è§„åˆ™
- âœ… ä»…æ´»åŠ¨æŠ¥åè€…å¯æŠ•ç¥¨
- âœ… æ¯äººæ‹¥æœ‰ 3 ç¥¨
- âœ… æ¯ç¥¨åªèƒ½æŠ•ç»™ä¸€ä¸ªä½œå“ï¼ˆä¸èƒ½é‡å¤æŠ•ç»™åŒä¸€ä½œå“ï¼‰
- âœ… ä¸èƒ½ç»™è‡ªå·±çš„ä½œå“æŠ•ç¥¨
- âœ… æŠ•ç¥¨å¯ä»¥å–æ¶ˆ
- âœ… æŠ•ç¥¨æˆªæ­¢æ—¶é—´ = æ´»åŠ¨ç»“æŸæ—¶é—´

#### æŠ•ç¥¨å±•ç¤º
- âœ… å¡ç‰‡è§†å›¾å±•ç¤ºæ‰€æœ‰ä½œå“
- âœ… å®æ—¶æ˜¾ç¤ºæŠ•ç¥¨æ•°å’Œæ’å
- âœ… è½®è¯¢åˆ·æ–°æŠ•ç¥¨ç»“æœï¼ˆé»˜è®¤ 2 ç§’/æ¬¡ï¼‰
- âœ… è§†é¢‘/éŸ³é¢‘ä½œå“æ”¯æŒåœ¨çº¿æ’­æ”¾

### 5. æƒé™æ§åˆ¶

| è§’è‰² | æµè§ˆä½œå“ | æäº¤ä½œå“ | ç¼–è¾‘ä½œå“ | æŠ•ç¥¨ |
|------|---------|---------|---------|------|
| æœªç™»å½•ç”¨æˆ· | âœ… | âŒ | âŒ | âŒ |
| å·²ç™»å½•ç”¨æˆ· | âœ… | âŒ | âŒ | âŒ |
| æ´»åŠ¨æŠ¥åè€… | âœ… | âœ… | âœ… (ä»…è‡ªå·±çš„) | âœ… |
| ä½œå“é˜Ÿé•¿ | âœ… | âœ… | âœ… (ä»…è‡ªå·±çš„) | âœ… |
| æ´»åŠ¨ç»„ç»‡è€… | âœ… | âœ… | âœ… (æ‰€æœ‰ä½œå“) | âœ… |

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. æ‰©å±•ç°æœ‰ Project æ¨¡å‹

```prisma
model Project {
  // ... ç°æœ‰å­—æ®µä¿æŒä¸å˜

  // æ–°å¢å­—æ®µ
  tagline              String?       // ä¸€å¥è¯ä»‹ç»
  communityUseAuth     Boolean       @default(false) // æ˜¯å¦æˆæƒç¤¾åŒºä½¿ç”¨
  customFields         Json?         // è‡ªå®šä¹‰å­—æ®µï¼ˆé¢„ç•™ï¼‰
  isSubmission         Boolean       @default(false) // æ ‡è®°æ˜¯å¦ä¸ºæ´»åŠ¨ä½œå“æäº¤
  submittedAt          DateTime?     // æäº¤æ—¶é—´

  // æ–°å¢å…³è”
  votes                ProjectVote[]
  attachments          ProjectAttachment[]
}
```

### 2. æ–°å¢ ProjectVote æ¨¡å‹

```prisma
model ProjectVote {
  id          String   @id @default(cuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@unique([projectId, userId, eventId])
  @@index([projectId])
  @@index([userId])
  @@index([eventId])
  @@map("project_vote")
}
```

### 3. æ–°å¢ ProjectAttachment æ¨¡å‹

```prisma
model ProjectAttachment {
  id          String   @id @default(cuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  fileName    String   // åŸå§‹æ–‡ä»¶å
  fileUrl     String   // COS å­˜å‚¨ URL
  fileType    String   // æ–‡ä»¶ç±»å‹: image, video, audio, file
  mimeType    String?  // MIME ç±»å‹: image/png, video/mp4, etc.
  fileSize    Int      // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  order       Int      @default(0) // æ’åº
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([projectId])
  @@map("project_attachment")
}
```

### 4. æ‰©å±• User æ¨¡å‹

```prisma
model User {
  // ... ç°æœ‰å­—æ®µä¿æŒä¸å˜

  // æ–°å¢å…³è”
  projectVotes        ProjectVote[]
}
```

### 5. æ‰©å±• Event æ¨¡å‹

```prisma
model Event {
  // ... ç°æœ‰å­—æ®µä¿æŒä¸å˜

  // æ–°å¢å…³è”
  projectVotes        ProjectVote[]
}
```

---

## é¡µé¢ç»“æ„ä¸è·¯ç”±

### å…¬å¼€é¡µé¢ï¼ˆMarketingï¼‰- æ‰€æœ‰äººå¯è§

```
app/(marketing)/[locale]/events/[eventId]/
â”œâ”€â”€ submissions/                      # ä½œå“å±•ç¤ºé¡µï¼ˆåˆ—è¡¨ + å¡ç‰‡è§†å›¾ï¼‰
â”‚   â””â”€â”€ [submissionId]/              # ä½œå“è¯¦æƒ…é¡µ
```

**è®¿é—®æƒé™**:
- æ‰€æœ‰äººå¯æµè§ˆ
- æœªç™»å½•ç”¨æˆ·ä¸èƒ½æŠ•ç¥¨ï¼ˆæ˜¾ç¤º"ç™»å½•åæŠ•ç¥¨"æŒ‰é’®ï¼‰
- å·²ç™»å½•ä½†æœªæŠ¥åç”¨æˆ·ä¸èƒ½æŠ•ç¥¨ï¼ˆæ˜¾ç¤º"æŠ¥ååå¯æŠ•ç¥¨"æç¤ºï¼‰
- å·²ç™»å½•ä¸”å·²æŠ¥åç”¨æˆ·å¯æŠ•ç¥¨

### ç§æœ‰é¡µé¢ï¼ˆSaaSï¼‰- éœ€è¦ç™»å½•

```
app/(saas)/app/events/[eventId]/
â”œâ”€â”€ submissions/
â”‚   â”œâ”€â”€ new/                         # æäº¤æ–°ä½œå“
â”‚   â””â”€â”€ [submissionId]/edit/         # ç¼–è¾‘ä½œå“
```

**è®¿é—®æƒé™**:
- å¿…é¡»ç™»å½•
- å¿…é¡»æ˜¯æ´»åŠ¨æŠ¥åè€…
- ç¼–è¾‘é¡µé¢ä»…é˜Ÿé•¿å¯è®¿é—®

---

## åŠŸèƒ½è¯¦ç»†è¯´æ˜

### 1. ä½œå“æäº¤æµç¨‹

#### 1.1 æäº¤å…¥å£
- **ä½ç½®**: æ´»åŠ¨è¯¦æƒ…é¡µï¼ˆ`/[locale]/events/[eventId]`ï¼‰
- **æŒ‰é’®**: "æäº¤ä½œå“" / "Submit Project"
- **æƒé™æ£€æŸ¥**:
  - æœªç™»å½• â†’ è·³è½¬ç™»å½•é¡µ
  - å·²ç™»å½•ä½†æœªæŠ¥å â†’ æç¤º"è¯·å…ˆæŠ¥åæ´»åŠ¨"
  - å·²æŠ¥å â†’ è·³è½¬æäº¤é¡µé¢

#### 1.2 æäº¤è¡¨å•

**æ­¥éª¤ 1: åŸºæœ¬ä¿¡æ¯**
- ä½œå“åç§°ï¼ˆå¿…å¡«ï¼Œ1-50 å­—ç¬¦ï¼‰
- ä¸€å¥è¯ä»‹ç»ï¼ˆå¿…å¡«ï¼Œ10-100 å­—ç¬¦ï¼‰
- è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼Œå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæœ€å¤š 5000 å­—ç¬¦ï¼‰
- é¡¹ç›®ç½‘å€ï¼ˆå¯é€‰ï¼ŒURL éªŒè¯ï¼‰

**æ­¥éª¤ 2: å›¢é˜Ÿä¿¡æ¯**
- é˜Ÿé•¿é€‰æ‹©ï¼ˆé»˜è®¤ä¸ºå½“å‰ç”¨æˆ·ï¼Œå¯ä»æŠ¥åè€…ä¸­é€‰æ‹©å…¶ä»–äººï¼‰
- é˜Ÿå‘˜æœç´¢ï¼ˆå¯æœç´¢å…¨å±€æ³¨å†Œç”¨æˆ·ï¼Œæœ€å¤š 10 äººï¼‰
  - å®æ—¶æœç´¢ç”¨æˆ·ï¼ˆæŒ‰ç”¨æˆ·åã€é‚®ç®±ï¼‰
  - æ˜¾ç¤ºç”¨æˆ·å¤´åƒã€å§“åã€ç®€ä»‹
  - å·²é€‰ç”¨æˆ·ä¸å†å‡ºç°åœ¨æœç´¢ç»“æœä¸­

**æ­¥éª¤ 3: é™„ä»¶ä¸Šä¼ **
- æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
- æ–‡ä»¶ç±»å‹ï¼šä¸é™
- å•ä¸ªæ–‡ä»¶å¤§å°ï¼šæœ€å¤§ 200MB
- ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- ä¸Šä¼ å®Œæˆåå¯é¢„è§ˆï¼ˆå›¾ç‰‡ï¼‰ã€æ’­æ”¾ï¼ˆè§†é¢‘/éŸ³é¢‘ï¼‰ã€ä¸‹è½½ï¼ˆæ–‡ä»¶ï¼‰

**æ­¥éª¤ 4: æˆæƒç¡®è®¤**
- å•é€‰é¢˜ï¼ˆå¿…å¡«ï¼‰: "æ˜¯å¦æˆæƒç¤¾åŒºä½¿ç”¨ä½ çš„ä½œå“ç”¨äºå®£ä¼ ç”¨é€”ï¼Ÿ"
  - é€‰é¡¹: æ˜¯ / å¦
  - æç¤º: "ä¸æˆæƒä¸ä¼šå½±å“ä½œå“å±•ç¤ºå’ŒæŠ•ç¥¨"

**è¡¨å•ç¼“å­˜**
- ä½¿ç”¨ localStorage è‡ªåŠ¨ä¿å­˜è¡¨å•æ•°æ®
- æ¯ 5 ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
- é¡µé¢åˆ·æ–°åæ¢å¤æ•°æ®
- æäº¤æˆåŠŸåæ¸…é™¤ç¼“å­˜

#### 1.3 æäº¤æˆåŠŸ
- æ˜¾ç¤ºæˆåŠŸæç¤º
- è·³è½¬åˆ°ä½œå“è¯¦æƒ…é¡µ
- å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

### 2. ä½œå“å±•ç¤ºé¡µ

#### 2.1 åˆ—è¡¨è§†å›¾ï¼ˆé»˜è®¤ï¼‰

**å¡ç‰‡å¸ƒå±€**
- ç½‘æ ¼å¸ƒå±€ï¼Œå“åº”å¼è®¾è®¡
  - æ¡Œé¢ç«¯ï¼š3 åˆ—
  - å¹³æ¿ç«¯ï¼š2 åˆ—
  - ç§»åŠ¨ç«¯ï¼š1 åˆ—

**å•ä¸ªå¡ç‰‡å†…å®¹**
- å°é¢å›¾ï¼ˆå–ç¬¬ä¸€ä¸ªå›¾ç‰‡é™„ä»¶ï¼Œæˆ–é»˜è®¤å ä½å›¾ï¼‰
- ä½œå“åç§°
- ä¸€å¥è¯ä»‹ç»
- é˜Ÿé•¿å¤´åƒå’Œå§“å
- å›¢é˜Ÿæˆå‘˜æ•°é‡
- æŠ•ç¥¨æ•°ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰
- æŠ•ç¥¨æŒ‰é’®ï¼ˆä»…æŠ¥åè€…å¯è§ï¼‰
- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®

**æ’åºä¸ç­›é€‰**
- é»˜è®¤æ’åºï¼šæŒ‰æŠ•ç¥¨æ•°é™åº
- å…¶ä»–æ’åºé€‰é¡¹ï¼š
  - æœ€æ–°æäº¤
  - æœ€æ—©æäº¤
  - ä½œå“åç§° A-Z
- ç­›é€‰é€‰é¡¹ï¼ˆæœªæ¥æ‰©å±•ï¼‰:
  - æŒ‰æ ‡ç­¾ç­›é€‰
  - æŒ‰åˆ†ç±»ç­›é€‰

**æŠ•ç¥¨åŒºåŸŸ**
- æ˜¾ç¤ºç”¨æˆ·å‰©ä½™ç¥¨æ•°ï¼š`ä½ è¿˜æœ‰ X ç¥¨`
- æŠ•ç¥¨æŒ‰é’®çŠ¶æ€ï¼š
  - æœªæŠ•ç¥¨ï¼šè“è‰²æŒ‰é’® "æŠ•ç¥¨"
  - å·²æŠ•ç¥¨ï¼šç»¿è‰²æŒ‰é’® "å·²æŠ•ç¥¨ âœ“"ï¼Œå¯ç‚¹å‡»å–æ¶ˆ
  - ä¸å¯æŠ•ç¥¨ï¼ˆè‡ªå·±çš„ä½œå“ï¼‰ï¼šç°è‰²ç¦ç”¨çŠ¶æ€ï¼Œæç¤º "ä¸èƒ½ç»™è‡ªå·±æŠ•ç¥¨"
  - ç¥¨æ•°ç”¨å®Œï¼šç°è‰²ç¦ç”¨çŠ¶æ€ï¼Œæç¤º "ç¥¨æ•°å·²ç”¨å®Œ"

#### 2.2 ä½œå“è¯¦æƒ…é¡µ

**å†…å®¹åŒº**
- ä½œå“åç§°ï¼ˆå¤§æ ‡é¢˜ï¼‰
- ä¸€å¥è¯ä»‹ç»
- è¯¦ç»†æè¿°ï¼ˆå¯Œæ–‡æœ¬æ¸²æŸ“ï¼‰
- é¡¹ç›®ç½‘å€ï¼ˆé“¾æ¥æŒ‰é’®ï¼‰
- é™„ä»¶å±•ç¤ºï¼š
  - å›¾ç‰‡ï¼šè½®æ’­å›¾æˆ–ç½‘æ ¼å±•ç¤º
  - è§†é¢‘ï¼šåµŒå…¥å¼æ’­æ”¾å™¨
  - éŸ³é¢‘ï¼šéŸ³é¢‘æ’­æ”¾å™¨
  - æ–‡ä»¶ï¼šä¸‹è½½é“¾æ¥

**å›¢é˜Ÿä¿¡æ¯**
- é˜Ÿé•¿ä¿¡æ¯ï¼ˆå¤´åƒã€å§“åã€è§’è‰²æ ‡è¯†ï¼‰
- é˜Ÿå‘˜åˆ—è¡¨ï¼ˆå¤´åƒã€å§“åï¼‰

**æŠ•ç¥¨ä¿¡æ¯**
- å½“å‰æŠ•ç¥¨æ•°
- æŠ•ç¥¨æ’å
- æŠ•ç¥¨æŒ‰é’®ï¼ˆåŒåˆ—è¡¨é¡µï¼‰

**æ“ä½œæŒ‰é’®**ï¼ˆä»…é˜Ÿé•¿å¯è§ï¼‰
- ç¼–è¾‘ä½œå“
- åˆ é™¤ä½œå“ï¼ˆéœ€äºŒæ¬¡ç¡®è®¤ï¼‰

#### 2.3 å®æ—¶æŠ•ç¥¨æ›´æ–°

**è½®è¯¢æœºåˆ¶**
- æ¯ 2 ç§’è½®è¯¢ä¸€æ¬¡æŠ•ç¥¨æ•°æ®
- ä»…åœ¨ä½œå“å±•ç¤ºé¡µæ¿€æ´»è½®è¯¢
- é¡µé¢ä¸å¯è§æ—¶æš‚åœè½®è¯¢ï¼ˆä½¿ç”¨ Page Visibility APIï¼‰
- æ•°æ®å˜åŒ–æ—¶å¹³æ»‘æ›´æ–° UIï¼ˆæ— é—ªçƒï¼‰

**WebSocketï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰**
- ç¬¬ä¸€ç‰ˆä½¿ç”¨è½®è¯¢
- åç»­å¯å‡çº§ä¸º WebSocket å®æ—¶æ¨é€

### 3. æŠ•ç¥¨é€»è¾‘

#### 3.1 æŠ•ç¥¨é™åˆ¶æ£€æŸ¥

```typescript
// ä¼ªä»£ç 
async function canVote(userId, projectId, eventId) {
  // æ£€æŸ¥ 1: ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
  if (!userId) return { canVote: false, reason: 'NOT_LOGGED_IN' }

  // æ£€æŸ¥ 2: ç”¨æˆ·æ˜¯å¦æ˜¯æ´»åŠ¨æŠ¥åè€…
  const participant = await getEventParticipant(eventId, userId)
  if (!participant) return { canVote: false, reason: 'NOT_REGISTERED' }

  // æ£€æŸ¥ 3: æ˜¯å¦æ˜¯è‡ªå·±çš„ä½œå“
  const project = await getProject(projectId)
  const isOwner = project.members.some(m => m.userId === userId)
  if (isOwner) return { canVote: false, reason: 'OWN_PROJECT' }

  // æ£€æŸ¥ 4: æ˜¯å¦å·²æŠ•ç¥¨
  const hasVoted = await hasUserVoted(userId, projectId, eventId)
  if (hasVoted) return { canVote: false, reason: 'ALREADY_VOTED' }

  // æ£€æŸ¥ 5: ç¥¨æ•°æ˜¯å¦ç”¨å®Œ
  const voteCount = await getUserVoteCount(userId, eventId)
  const maxVotes = 3
  if (voteCount >= maxVotes) return { canVote: false, reason: 'NO_VOTES_LEFT' }

  // æ£€æŸ¥ 6: æŠ•ç¥¨æ˜¯å¦å·²æˆªæ­¢ï¼ˆæ´»åŠ¨ç»“æŸæ—¶é—´ï¼‰
  const event = await getEvent(eventId)
  if (new Date() > event.endDate) return { canVote: false, reason: 'VOTING_ENDED' }

  return { canVote: true }
}
```

#### 3.2 æŠ•ç¥¨æ“ä½œ

**æŠ•ç¥¨**
```typescript
async function vote(userId, projectId, eventId) {
  // 1. æƒé™æ£€æŸ¥
  const check = await canVote(userId, projectId, eventId)
  if (!check.canVote) throw new Error(check.reason)

  // 2. åˆ›å»ºæŠ•ç¥¨è®°å½•
  await createVote({ userId, projectId, eventId })

  // 3. æ›´æ–°é¡¹ç›®æŠ•ç¥¨æ•°ï¼ˆç¼“å­˜ï¼‰
  await incrementProjectVoteCount(projectId)

  // 4. è¿”å›æœ€æ–°æŠ•ç¥¨æ•°æ®
  return await getProjectVoteStats(projectId)
}
```

**å–æ¶ˆæŠ•ç¥¨**
```typescript
async function cancelVote(userId, projectId, eventId) {
  // 1. åˆ é™¤æŠ•ç¥¨è®°å½•
  await deleteVote({ userId, projectId, eventId })

  // 2. æ›´æ–°é¡¹ç›®æŠ•ç¥¨æ•°ï¼ˆç¼“å­˜ï¼‰
  await decrementProjectVoteCount(projectId)

  // 3. è¿”å›æœ€æ–°æŠ•ç¥¨æ•°æ®
  return await getProjectVoteStats(projectId)
}
```

### 4. ç¼–è¾‘ä½œå“

#### 4.1 æƒé™æ£€æŸ¥
- å¿…é¡»æ˜¯ä½œå“é˜Ÿé•¿
- æˆ–è€…æ˜¯æ´»åŠ¨ç»„ç»‡è€…

#### 4.2 ç¼–è¾‘è¡¨å•
- å¤ç”¨æäº¤è¡¨å•ç»„ä»¶
- é¢„å¡«å……ç°æœ‰æ•°æ®
- æ”¯æŒæ‰€æœ‰å­—æ®µä¿®æ”¹
- é™„ä»¶ç®¡ç†ï¼š
  - åˆ é™¤ç°æœ‰é™„ä»¶
  - æ·»åŠ æ–°é™„ä»¶
  - è°ƒæ•´é™„ä»¶æ’åº

#### 4.3 ä¿å­˜é€»è¾‘
- æ›´æ–° Project è¡¨
- æ›´æ–° ProjectMember è¡¨ï¼ˆå¦‚æœå›¢é˜Ÿæœ‰å˜åŒ–ï¼‰
- æ›´æ–° ProjectAttachment è¡¨ï¼ˆå¦‚æœé™„ä»¶æœ‰å˜åŒ–ï¼‰
- åˆ é™¤æ—§é™„ä»¶æ—¶åŒæ­¥åˆ é™¤ COS æ–‡ä»¶

---

## æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ–‡ä»¶ä¸Šä¼ 

#### 1.1 å‰ç«¯ä¸Šä¼ æµç¨‹
```typescript
// 1. è·å–ç­¾å URL
const { signedUrl } = await fetch('/api/uploads/signed-upload-url', {
  method: 'POST',
  body: JSON.stringify({
    bucket: 'project-attachments',
    path: `events/${eventId}/projects/${projectId}/${fileName}`
  })
})

// 2. ç›´æ¥ä¸Šä¼ åˆ° COS
await fetch(signedUrl, {
  method: 'PUT',
  body: file,
  headers: { 'Content-Type': file.type }
})

// 3. ä¿å­˜é™„ä»¶è®°å½•åˆ°æ•°æ®åº“
await fetch('/api/projects/${projectId}/attachments', {
  method: 'POST',
  body: JSON.stringify({
    fileName,
    fileUrl: publicUrl,
    fileType,
    mimeType: file.type,
    fileSize: file.size
  })
})
```

#### 1.2 æ”¯æŒçš„æ–‡ä»¶ç±»å‹
```typescript
const FILE_TYPES = {
  image: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'],
  video: ['video/mp4', 'video/webm', 'video/ogg', 'video/quicktime'],
  audio: ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/aac', 'audio/webm'],
  file: '*' // å…¶ä»–æ‰€æœ‰ç±»å‹
}
```

#### 1.3 æ–‡ä»¶å¤§å°é™åˆ¶
- å‰ç«¯æ£€æŸ¥ï¼šä¸Šä¼ å‰éªŒè¯æ–‡ä»¶å¤§å°
- åç«¯æ£€æŸ¥ï¼šAPI å±‚å†æ¬¡éªŒè¯
- æœ€å¤§é™åˆ¶ï¼š200MB/æ–‡ä»¶

### 2. è¡¨å•ç¼“å­˜

```typescript
// è‡ªåŠ¨ä¿å­˜
useEffect(() => {
  const timer = setInterval(() => {
    localStorage.setItem(
      `submission_draft_${eventId}`,
      JSON.stringify(formData)
    )
  }, 5000)
  return () => clearInterval(timer)
}, [formData, eventId])

// æ¢å¤æ•°æ®
useEffect(() => {
  const draft = localStorage.getItem(`submission_draft_${eventId}`)
  if (draft) {
    const data = JSON.parse(draft)
    setFormData(data)
    toast.info('å·²æ¢å¤ä¸Šæ¬¡æœªå®Œæˆçš„æäº¤')
  }
}, [eventId])

// æ¸…é™¤ç¼“å­˜
const handleSubmitSuccess = () => {
  localStorage.removeItem(`submission_draft_${eventId}`)
}
```

### 3. æŠ•ç¥¨è½®è¯¢

```typescript
// ä½¿ç”¨ SWR æˆ– React Query å®ç°è½®è¯¢
import useSWR from 'swr'

function SubmissionList({ eventId }) {
  const { data: submissions } = useSWR(
    `/api/events/${eventId}/submissions?includeVotes=true`,
    fetcher,
    {
      refreshInterval: 2000, // 2ç§’è½®è¯¢
      revalidateOnFocus: true,
      dedupingInterval: 1000
    }
  )

  return <SubmissionCards submissions={submissions} />
}
```

### 4. å“åº”å¼å¡ç‰‡å¸ƒå±€

```typescript
// ä½¿ç”¨ Tailwind CSS Grid
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {submissions.map(submission => (
    <SubmissionCard key={submission.id} submission={submission} />
  ))}
</div>
```

### 5. è§†é¢‘/éŸ³é¢‘æ’­æ”¾å™¨

```typescript
// ä½¿ç”¨åŸç”Ÿ HTML5 æ’­æ”¾å™¨ æˆ–ç¬¬ä¸‰æ–¹åº“
import ReactPlayer from 'react-player'

function MediaPlayer({ attachment }) {
  if (attachment.fileType === 'video') {
    return (
      <ReactPlayer
        url={attachment.fileUrl}
        controls
        width="100%"
        height="auto"
      />
    )
  }

  if (attachment.fileType === 'audio') {
    return (
      <audio controls className="w-full">
        <source src={attachment.fileUrl} type={attachment.mimeType} />
      </audio>
    )
  }

  return null
}
```

---

## API ç«¯ç‚¹è®¾è®¡

### 1. ä½œå“æäº¤ç›¸å…³

#### `POST /api/events/:eventId/submissions`
åˆ›å»ºæ–°ä½œå“

**Request Body**:
```json
{
  "name": "ä½œå“åç§°",
  "tagline": "ä¸€å¥è¯ä»‹ç»",
  "description": "è¯¦ç»†æè¿°",
  "demoUrl": "https://example.com",
  "teamLeaderId": "user_123",
  "teamMemberIds": ["user_456", "user_789"],
  "attachments": [
    {
      "fileName": "demo.mp4",
      "fileUrl": "https://cos.../demo.mp4",
      "fileType": "video",
      "mimeType": "video/mp4",
      "fileSize": 1024000
    }
  ],
  "communityUseAuthorization": true
}
```

**Response**:
```json
{
  "id": "project_123",
  "name": "ä½œå“åç§°",
  "tagline": "ä¸€å¥è¯ä»‹ç»",
  "eventId": "event_456",
  "createdAt": "2025-11-12T10:00:00Z",
  "voteCount": 0
}
```

#### `GET /api/events/:eventId/submissions`
è·å–æ´»åŠ¨çš„æ‰€æœ‰ä½œå“

**Query Parameters**:
- `sort`: æ’åºæ–¹å¼ (voteCount | createdAt | name)
- `order`: æ’åºé¡ºåº (asc | desc)
- `includeVotes`: æ˜¯å¦åŒ…å«æŠ•ç¥¨è¯¦æƒ… (true | false)

**Response**:
```json
{
  "submissions": [
    {
      "id": "project_123",
      "name": "ä½œå“åç§°",
      "tagline": "ä¸€å¥è¯ä»‹ç»",
      "coverImage": "https://...",
      "voteCount": 5,
      "teamLeader": {
        "id": "user_123",
        "name": "å¼ ä¸‰",
        "avatar": "https://..."
      },
      "teamSize": 3,
      "createdAt": "2025-11-12T10:00:00Z"
    }
  ],
  "total": 10,
  "userVotes": ["project_123", "project_456"], // å½“å‰ç”¨æˆ·å·²æŠ•ç¥¨çš„ä½œå“ID
  "remainingVotes": 2 // å½“å‰ç”¨æˆ·å‰©ä½™ç¥¨æ•°
}
```

#### `GET /api/submissions/:submissionId`
è·å–ä½œå“è¯¦æƒ…

**Response**:
```json
{
  "id": "project_123",
  "name": "ä½œå“åç§°",
  "tagline": "ä¸€å¥è¯ä»‹ç»",
  "description": "è¯¦ç»†æè¿°...",
  "demoUrl": "https://example.com",
  "coverImage": "https://...",
  "voteCount": 5,
  "rank": 3,
  "teamLeader": {
    "id": "user_123",
    "name": "å¼ ä¸‰",
    "avatar": "https://...",
    "bio": "äº§å“ç»ç†"
  },
  "teamMembers": [
    {
      "id": "user_456",
      "name": "æå››",
      "avatar": "https://...",
      "role": "member"
    }
  ],
  "attachments": [
    {
      "id": "att_789",
      "fileName": "demo.mp4",
      "fileUrl": "https://...",
      "fileType": "video",
      "mimeType": "video/mp4",
      "fileSize": 1024000,
      "order": 0
    }
  ],
  "communityUseAuthorization": true,
  "eventId": "event_456",
  "createdAt": "2025-11-12T10:00:00Z",
  "updatedAt": "2025-11-12T11:00:00Z"
}
```

#### `PATCH /api/submissions/:submissionId`
ç¼–è¾‘ä½œå“ï¼ˆä»…é˜Ÿé•¿æˆ–ç»„ç»‡è€…ï¼‰

**Request Body**: åŒåˆ›å»ºæ¥å£

#### `DELETE /api/submissions/:submissionId`
åˆ é™¤ä½œå“ï¼ˆä»…é˜Ÿé•¿æˆ–ç»„ç»‡è€…ï¼‰

### 2. æŠ•ç¥¨ç›¸å…³

#### `POST /api/submissions/:submissionId/vote`
æŠ•ç¥¨

**Response**:
```json
{
  "success": true,
  "voteCount": 6,
  "remainingVotes": 2
}
```

**Error Response**:
```json
{
  "error": "ALREADY_VOTED",
  "message": "ä½ å·²ç»ç»™è¿™ä¸ªä½œå“æŠ•è¿‡ç¥¨äº†"
}
```

#### `DELETE /api/submissions/:submissionId/vote`
å–æ¶ˆæŠ•ç¥¨

**Response**:
```json
{
  "success": true,
  "voteCount": 5,
  "remainingVotes": 3
}
```

#### `GET /api/events/:eventId/votes/stats`
è·å–æŠ•ç¥¨ç»Ÿè®¡

**Response**:
```json
{
  "totalVotes": 45,
  "totalParticipants": 20,
  "votedParticipants": 15,
  "topSubmissions": [
    {
      "id": "project_123",
      "name": "ä½œå“A",
      "voteCount": 12,
      "rank": 1
    }
  ]
}
```

### 3. å›¢é˜Ÿç®¡ç†ç›¸å…³

#### `GET /api/events/:eventId/participants/search`
æœç´¢æ´»åŠ¨å‚ä¸è€…æˆ–å…¨å±€ç”¨æˆ·

**Query Parameters**:
- `q`: æœç´¢å…³é”®è¯
- `scope`: æœç´¢èŒƒå›´ (event | global)
- `excludeIds`: æ’é™¤çš„ç”¨æˆ·IDåˆ—è¡¨

**Response**:
```json
{
  "users": [
    {
      "id": "user_123",
      "name": "å¼ ä¸‰",
      "email": "zhangsan@example.com",
      "avatar": "https://...",
      "bio": "äº§å“ç»ç†",
      "isParticipant": true
    }
  ]
}
```

### 4. æ–‡ä»¶ä¸Šä¼ ç›¸å…³

#### `POST /api/uploads/signed-upload-url`
è·å–æ–‡ä»¶ä¸Šä¼ ç­¾å URLï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰

**Request Body**:
```json
{
  "bucket": "project-attachments",
  "path": "events/event_123/projects/project_456/demo.mp4",
  "contentType": "video/mp4",
  "fileSize": 1024000
}
```

**Response**:
```json
{
  "signedUrl": "https://cos...?signature=...",
  "publicUrl": "https://cos.../events/event_123/projects/project_456/demo.mp4",
  "expiresIn": 3600
}
```

---

## å¼€å‘ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬ä¸€ç‰ˆå¿…é¡»ï¼‰
1. âœ… æ•°æ®åº“ Schema è®¾è®¡å’Œè¿ç§»
2. âœ… ä½œå“æäº¤è¡¨å•ï¼ˆåŸºæœ¬ä¿¡æ¯ + å›¢é˜Ÿ + æˆæƒï¼‰
3. âœ… ä½œå“åˆ—è¡¨å±•ç¤ºï¼ˆå¡ç‰‡è§†å›¾ï¼‰
4. âœ… æŠ•ç¥¨åŠŸèƒ½ï¼ˆæŠ•ç¥¨/å–æ¶ˆæŠ•ç¥¨ï¼‰
5. âœ… æŠ•ç¥¨ç»“æœè½®è¯¢åˆ·æ–°
6. âœ… å›¾ç‰‡ä¸Šä¼ å’Œå±•ç¤º
7. âœ… æƒé™æ§åˆ¶ï¼ˆæŠ¥åè€…æ‰èƒ½æäº¤å’ŒæŠ•ç¥¨ï¼‰

### P1 - é‡è¦åŠŸèƒ½ï¼ˆç¬¬ä¸€ç‰ˆæœ€å¥½æœ‰ï¼‰
1. âœ… ä½œå“è¯¦æƒ…é¡µ
2. âœ… ç¼–è¾‘ä½œå“åŠŸèƒ½
3. âœ… è§†é¢‘/éŸ³é¢‘ä¸Šä¼ å’Œæ’­æ”¾
4. âœ… è¡¨å•ç¼“å­˜ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰
5. âœ… å›¢é˜Ÿæˆå‘˜æœç´¢
6. âœ… å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰
7. âœ… æ–‡ä»¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

### P2 - å¢å¼ºåŠŸèƒ½ï¼ˆç¬¬äºŒç‰ˆï¼‰
1. â¸ è‡ªå®šä¹‰å­—æ®µï¼ˆä¸åŒæ´»åŠ¨ä¸åŒå­—æ®µï¼‰
2. â¸ ä½œå“åˆ†ç±»å’Œæ ‡ç­¾ç­›é€‰
3. â¸ ä½œå“æœç´¢åŠŸèƒ½
4. â¸ WebSocket å®æ—¶æŠ•ç¥¨
5. â¸ å¯¼å‡ºä½œå“æ•°æ®ï¼ˆExcel/CSVï¼‰
6. â¸ ä½œå“å¤ç›˜å’Œç»Ÿè®¡åˆ†æ
7. â¸ é‚®ä»¶é€šçŸ¥ï¼ˆä½œå“è¢«æŠ•ç¥¨æ—¶ï¼‰

### P3 - æœªæ¥ä¼˜åŒ–ï¼ˆç¬¬ä¸‰ç‰ˆ+ï¼‰
1. â¸ å¤šè½®æŠ•ç¥¨ï¼ˆåˆé€‰ã€å†³èµ›ï¼‰
2. â¸ è¯„å§”æ‰“åˆ†ç³»ç»Ÿ
3. â¸ ä½œå“è¯„è®ºåŠŸèƒ½
4. â¸ ä½œå“ç‚¹èµåŠŸèƒ½
5. â¸ ä½œå“åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“
6. â¸ ä½œå“æ¨èç®—æ³•
7. â¸ å›½é™…åŒ–æ”¯æŒï¼ˆå¤šè¯­è¨€ï¼‰

---

## éåŠŸèƒ½éœ€æ±‚

### 1. æ€§èƒ½è¦æ±‚
- ä½œå“åˆ—è¡¨åŠ è½½æ—¶é—´ < 2 ç§’
- æŠ•ç¥¨å“åº”æ—¶é—´ < 500ms
- æ–‡ä»¶ä¸Šä¼ æ”¯æŒå¤§æ–‡ä»¶ï¼ˆ200MBï¼‰
- æ”¯æŒ 100+ ä½œå“åŒæ—¶å±•ç¤º

### 2. å®‰å…¨è¦æ±‚
- æ–‡ä»¶ä¸Šä¼ ç±»å‹éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- API æ¥å£é˜²åˆ·ï¼ˆæŠ•ç¥¨é™æµï¼‰
- XSS é˜²æŠ¤ï¼ˆå¯Œæ–‡æœ¬å†…å®¹ï¼‰
- CSRF é˜²æŠ¤

### 3. å…¼å®¹æ€§è¦æ±‚
- æµè§ˆå™¨ï¼šChromeã€Firefoxã€Safariã€Edgeï¼ˆæœ€æ–°ä¸¤ä¸ªç‰ˆæœ¬ï¼‰
- ç§»åŠ¨ç«¯ï¼šiOS Safariã€Android Chrome
- å“åº”å¼è®¾è®¡ï¼šæ”¯æŒæ¡Œé¢ã€å¹³æ¿ã€æ‰‹æœº

### 4. å¯ç»´æŠ¤æ€§è¦æ±‚
- ä»£ç æ¨¡å—åŒ–ï¼Œç»„ä»¶å¤ç”¨
- API æ–‡æ¡£å®Œæ•´
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- æ—¥å¿—è®°å½•ï¼ˆé”™è¯¯æ—¥å¿—ã€æ“ä½œæ—¥å¿—ï¼‰

---

## æµ‹è¯•è¦ç‚¹

### 1. åŠŸèƒ½æµ‹è¯•
- [ ] æŠ¥åè€…å¯ä»¥æäº¤ä½œå“
- [ ] æœªæŠ¥åç”¨æˆ·ä¸èƒ½æäº¤ä½œå“
- [ ] å¯ä»¥æ·»åŠ  10 ä¸ªå›¢é˜Ÿæˆå‘˜
- [ ] ä¸èƒ½æ·»åŠ è¶…è¿‡ 10 ä¸ªå›¢é˜Ÿæˆå‘˜
- [ ] é˜Ÿé•¿å¯ä»¥ç¼–è¾‘ä½œå“
- [ ] é˜Ÿå‘˜ä¸èƒ½ç¼–è¾‘ä½œå“
- [ ] æŠ¥åè€…å¯ä»¥æŠ•ç¥¨
- [ ] ä¸èƒ½ç»™è‡ªå·±çš„ä½œå“æŠ•ç¥¨
- [ ] æ¯äººæœ€å¤š 3 ç¥¨
- [ ] æŠ•ç¥¨åå¯ä»¥å–æ¶ˆ
- [ ] æ´»åŠ¨ç»“æŸåä¸èƒ½æŠ•ç¥¨
- [ ] æŠ•ç¥¨æ•°å®æ—¶æ›´æ–°

### 2. è¾¹ç•Œæµ‹è¯•
- [ ] ä½œå“åç§° 50 å­—ç¬¦
- [ ] ä¸€å¥è¯ä»‹ç» 100 å­—ç¬¦
- [ ] è¯¦ç»†æè¿° 5000 å­—ç¬¦
- [ ] å•ä¸ªæ–‡ä»¶ 200MB
- [ ] ä¸Šä¼  10+ ä¸ªæ–‡ä»¶

### 3. å®‰å…¨æµ‹è¯•
- [ ] SQL æ³¨å…¥æµ‹è¯•
- [ ] XSS æ”»å‡»æµ‹è¯•
- [ ] æ–‡ä»¶ä¸Šä¼ æ¶æ„æ–‡ä»¶æµ‹è¯•
- [ ] API è¶Šæƒæµ‹è¯•
- [ ] åˆ·ç¥¨æµ‹è¯•

### 4. æ€§èƒ½æµ‹è¯•
- [ ] 100 ä¸ªä½œå“åŠ è½½æ—¶é—´
- [ ] å¹¶å‘æŠ•ç¥¨æµ‹è¯•ï¼ˆ50+ ç”¨æˆ·åŒæ—¶æŠ•ç¥¨ï¼‰
- [ ] å¤§æ–‡ä»¶ä¸Šä¼ ç¨³å®šæ€§
- [ ] é•¿æ—¶é—´è½®è¯¢å†…å­˜æ³„æ¼

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Next.js 16 + React 19
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS
- **çŠ¶æ€ç®¡ç†**: React Query / SWR
- **è¡¨å•**: React Hook Form + Zod
- **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨**: TipTap æˆ– Quill
- **æ–‡ä»¶ä¸Šä¼ **: React Dropzone
- **è§†é¢‘æ’­æ”¾å™¨**: React Player

### åç«¯
- **æ¡†æ¶**: Hono (å·²æœ‰)
- **è¯­è¨€**: TypeScript
- **ORM**: Prisma
- **æ•°æ®åº“**: PostgreSQL
- **å¯¹è±¡å­˜å‚¨**: COS (è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨)
- **è®¤è¯**: Better Auth (å·²æœ‰)

### å¼€å‘å·¥å…·
- **åŒ…ç®¡ç†**: pnpm
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **Git**: Conventional Commits

---

## æ•°æ®åº“è¿ç§»è®¡åˆ’

```sql
-- Migration: æ·»åŠ ä½œå“æäº¤ç›¸å…³è¡¨

-- 1. æ‰©å±• Project è¡¨
ALTER TABLE "project"
ADD COLUMN "tagline" TEXT,
ADD COLUMN "communityUseAuth" BOOLEAN DEFAULT false,
ADD COLUMN "customFields" JSONB,
ADD COLUMN "isSubmission" BOOLEAN DEFAULT false,
ADD COLUMN "submittedAt" TIMESTAMP;

-- 2. åˆ›å»º ProjectVote è¡¨
CREATE TABLE "project_vote" (
  "id" TEXT PRIMARY KEY,
  "projectId" TEXT NOT NULL REFERENCES "project"("id") ON DELETE CASCADE,
  "userId" TEXT NOT NULL REFERENCES "user"("id") ON DELETE CASCADE,
  "eventId" TEXT NOT NULL REFERENCES "event"("id") ON DELETE CASCADE,
  "createdAt" TIMESTAMP NOT NULL DEFAULT NOW(),
  UNIQUE("projectId", "userId", "eventId")
);

CREATE INDEX "project_vote_projectId_idx" ON "project_vote"("projectId");
CREATE INDEX "project_vote_userId_idx" ON "project_vote"("userId");
CREATE INDEX "project_vote_eventId_idx" ON "project_vote"("eventId");

-- 3. åˆ›å»º ProjectAttachment è¡¨
CREATE TABLE "project_attachment" (
  "id" TEXT PRIMARY KEY,
  "projectId" TEXT NOT NULL REFERENCES "project"("id") ON DELETE CASCADE,
  "fileName" TEXT NOT NULL,
  "fileUrl" TEXT NOT NULL,
  "fileType" TEXT NOT NULL,
  "mimeType" TEXT,
  "fileSize" INTEGER NOT NULL,
  "order" INTEGER DEFAULT 0,
  "createdAt" TIMESTAMP NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX "project_attachment_projectId_idx" ON "project_attachment"("projectId");
```

---

## é™„å½•

### A. é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | HTTP çŠ¶æ€ç  |
|--------|------|------------|
| NOT_LOGGED_IN | ç”¨æˆ·æœªç™»å½• | 401 |
| NOT_REGISTERED | ç”¨æˆ·æœªæŠ¥åæ´»åŠ¨ | 403 |
| NOT_TEAM_LEADER | éé˜Ÿé•¿æ— æƒç¼–è¾‘ | 403 |
| OWN_PROJECT | ä¸èƒ½ç»™è‡ªå·±çš„ä½œå“æŠ•ç¥¨ | 400 |
| ALREADY_VOTED | å·²ç»æŠ•è¿‡ç¥¨ | 400 |
| NO_VOTES_LEFT | ç¥¨æ•°å·²ç”¨å®Œ | 400 |
| VOTING_ENDED | æŠ•ç¥¨å·²æˆªæ­¢ | 400 |
| FILE_TOO_LARGE | æ–‡ä»¶è¿‡å¤§ | 400 |
| INVALID_FILE_TYPE | ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ | 400 |
| TEAM_SIZE_EXCEEDED | å›¢é˜Ÿæˆå‘˜è¶…è¿‡ä¸Šé™ | 400 |

### B. ç¯å¢ƒå˜é‡

```env
# å¯¹è±¡å­˜å‚¨é…ç½®
COS_SECRET_ID=xxx
COS_SECRET_KEY=xxx
COS_BUCKET_PROJECT_ATTACHMENTS=project-attachments
COS_REGION=ap-guangzhou

# æ–‡ä»¶ä¸Šä¼ é…ç½®
MAX_FILE_SIZE=209715200  # 200MB in bytes
UPLOAD_SIGNED_URL_EXPIRES=3600  # 1 hour
```

### C. ç›¸å…³æ–‡æ¡£é“¾æ¥
- [Prisma Schema æ–‡æ¡£](https://www.prisma.io/docs/concepts/components/prisma-schema)
- [Next.js App Router æ–‡æ¡£](https://nextjs.org/docs/app)
- [Hono æ¡†æ¶æ–‡æ¡£](https://hono.dev/)
- [è…¾è®¯äº‘ COS æ–‡æ¡£](https://cloud.tencent.com/document/product/436)

---

**æ–‡æ¡£ç»“æŸ**
