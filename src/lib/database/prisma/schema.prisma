generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-musl-arm64-openssl-3.0.x"]
}

generator zod {
  provider         = "zod-prisma-types"
  output           = "./zod"
  addIncludeType   = "false"
  addSelectType    = "false"
  createInputTypes = "true"
}

generator json {
  provider = "prisma-json-types-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String       @id @default(cuid())
  name               String
  email              String       @unique
  emailVerified      Boolean
  image              String?
  createdAt          DateTime
  updatedAt          DateTime
  username           String?      @unique
  role               String?
  banned             Boolean?
  banReason          String?
  banExpires         DateTime?
  onboardingComplete Boolean      @default(false)
  paymentsCustomerId String?
  locale             String?
  twoFactorEnabled   Boolean?
  bio                String?
  region             String? // åœ°åŒºå­—æ®µ
  phoneNumber        String? @unique
  phoneNumberVerified Boolean? // æ‰‹æœºå·éªŒè¯çŠ¶æ€
  pendingInvitationId String?
  gender             Gender?
  // ç”¨æˆ·ä¿¡æ¯å­—æ®µ
  userRoleString     String? // ç”¨æˆ·è§’è‰²ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰
  currentWorkOn        String? // å½“å‰åœ¨åšä»€ä¹ˆ
  // ç®€åŒ–çš„èµ„æºåŒ¹é…å­—æ®µ
  whatICanOffer      String? // æˆ‘èƒ½æä¾›ä»€ä¹ˆ
  whatIAmLookingFor  String? // æˆ‘åœ¨å¯»æ‰¾ä»€ä¹ˆ
  skills             String[] @default([]) // æŠ€èƒ½åˆ—è¡¨
  lifeStatus         String? // å½“å‰çŠ¶æ€ï¼ˆæ”¯æŒè‡ªå®šä¹‰ï¼‰
  lastProfileUpdate  DateTime?    // æœ€åæ›´æ–°æ—¶é—´
  githubUrl          String?
  twitterUrl         String?
  websiteUrl         String?
  wechatId           String?      // å¾®ä¿¡å·
  wechatQrCode       String?      // å¾®ä¿¡äºŒç»´ç å›¾ç‰‡URL
  wechatOpenId       String?
  wechatUnionId      String?  // å¾®ä¿¡UnionIDï¼Œç”¨äºå…³è”åŒä¸€å¼€å‘è€…è´¦å·ä¸‹çš„å¤šä¸ªåº”ç”¨ï¼ˆç§»é™¤å”¯ä¸€æ€§çº¦æŸä»¥æ”¯æŒå¾®ä¿¡pc/mobileç»‘å®šç”¨æˆ·æ—¶ä¸´æ—¶åˆ›å»ºï¼‰
  cpValue            Int          @default(0)
  joinedAt           DateTime?    @default(now())
  profileViews       Int          @default(0)
  profilePublic      Boolean      @default(true)
  showEmail          Boolean      @default(true)
  showWechat         Boolean      @default(false)
  // èº«ä»½éªŒè¯å­—æ®µï¼ˆå®ååˆ¶æ´»åŠ¨ä½¿ç”¨ï¼Œä¸¥æ ¼ä¿å¯†ï¼‰
  realName           String?      // çœŸå®å§“å
  idCard             String?      // èº«ä»½è¯å·
  idCardVerified     Boolean      @default(false) // èº«ä»½è¯éªŒè¯çŠ¶æ€
  shippingAddress    String?      // å¿«é€’åœ°å€
  shippingName       String?      // æ”¶ä»¶äººå§“å
  shippingPhone      String?      // æ”¶ä»¶äººç”µè¯
  identityVerifiedAt DateTime?    // èº«ä»½éªŒè¯æ—¶é—´
  
  // Level system fields
  membershipLevel    MembershipLevel?  // åŸºç¡€æˆå‘˜ç­‰çº§
  creatorLevel       CreatorLevel?     // åˆ›é€ è€…è½¨é“ç­‰çº§
  mentorLevel        MentorLevel?      // å¯¼å¸ˆè½¨é“ç­‰çº§
  contributorLevel   ContributorLevel? // è´¡çŒ®è€…è½¨é“ç­‰çº§  
  
  accounts           Account[]
  aiChats            AiChat[]
  invitations        Invitation[]
  targetedInvitations Invitation[] @relation("InvitationTargetUser")
  members            Member[]
  organizationInvitationRequests OrganizationInvitationRequest[]
  pendingInvitation  Invitation? @relation("PendingInvitation", fields: [pendingInvitationId], references: [id])
  passkeys           Passkey[]
  projects           Project[]
  purchases          Purchase[]
  sessions           Session[]
  twofactors         TwoFactor[]
  
  // Project system relations
  projectLikes       ProjectLike[]
  projectComments    ProjectComment[]
  projectBookmarks   ProjectBookmark[]
  projectMembers     ProjectMember[]  // Projects where user is a team member
  projectVotes       ProjectVote[]
  
  // Universal comment system relations
  comments           Comment[]         // ç”¨æˆ·å‘è¡¨çš„è¯„è®º
  commentLikes       CommentLike[]     // ç”¨æˆ·ç‚¹èµçš„è¯„è®º
  deletedComments    Comment[]         @relation("DeletedComments") // ç”¨æˆ·åˆ é™¤çš„è¯„è®º
  
  // Event system relations
  organizedEvents     Event[]               @relation("OrganizedEvents")
  eventRegistrations  EventRegistration[]
  eventAnswers        EventAnswer[]
  eventCheckIns       EventCheckIn[]
  eventFeedbacks      EventFeedback[]
  eventPhotos         EventPhoto[]
  reviewedRegistrations EventRegistration[] @relation("ReviewedRegistrations")
  checkInOperations   EventCheckIn[]        @relation("CheckInOperations")
  
  // Contribution system relations
  contributions       Contribution[]
  reviewedContributions Contribution[]      @relation("ReviewedContributions")
  
  // Badge system relations
  userBadges          UserBadge[]
  awardedBadges       UserBadge[]           @relation("AwardedBadges")
  
  // Admin system relations
  adminLogs           AdminLog[]
  configUpdates       SystemConfig[]
  
  // Community Task system relations
  publishedTasks      CommunityTask[]       @relation("PublishedTasks")
  assignedTasks       CommunityTask[]       @relation("AssignedTasks")
  
  // Email system relations
  emailCampaigns      EmailCampaign[]
  emailJobs           EmailJob[]
  emailPreference     UserEmailPreference?
  
  // Website system relations
  submittedWebsites   Website[]         // æäº¤çš„ç½‘ç«™
  approvedWebsites    Website[]         @relation("ApprovedWebsites") // å®¡æ ¸é€šè¿‡çš„ç½‘ç«™
  
  // Organization application relations
  organizationApplications OrganizationApplication[]
  reviewedApplications     OrganizationApplication[] @relation("ReviewedApplications")

  // User following relations
  following               UserFollow[]  // æˆ‘å…³æ³¨çš„ç”¨æˆ·
  followers               UserFollow[]  @relation("Followers") // å…³æ³¨æˆ‘çš„ç”¨æˆ·

  // Event bookmark relations
  eventBookmarks          EventBookmark[] // æˆ‘æ”¶è—çš„æ´»åŠ¨
  
  // Event host subscription relations
  eventHostSubscriptions  EventHostSubscription[] @relation("UserEventHostSubscriptions") // æˆ‘è®¢é˜…çš„ä¸»åŠæ–¹
  eventHostFollowers      EventHostSubscription[] @relation("EventHostFollowers") // è®¢é˜…æˆ‘å‘å¸ƒæ´»åŠ¨çš„ç”¨æˆ·
  
  // Universal like system relations
  userLikes               UserLike[]      // æˆ‘ç‚¹èµçš„ç”¨æˆ·
  userLikedBy             UserLike[]      @relation("LikedUsers") // ç‚¹èµæˆ‘çš„ç”¨æˆ·
  eventLikes              EventLike[]     // æˆ‘ç‚¹èµçš„æ´»åŠ¨
  websiteLikes            WebsiteLike[]   // æˆ‘ç‚¹èµçš„ç½‘ç«™

  // Notification system relations
  notifications           Notification[]
  relatedNotifications    Notification[]  @relation("RelatedNotifications")
  notificationPreference  NotificationPreference?
  emailNotificationQueue  EmailNotificationQueue[]

  // Event Admin system relations
  eventAdmins             EventAdmin[]    @relation("EventAdmins")
  eventAdminInvitations   EventAdmin[]    @relation("EventAdminInvitations")

  // Event Communication system relations
  sentCommunications      EventCommunication[] @relation("SentCommunications") // å‘é€çš„æ´»åŠ¨é€šä¿¡
  receivedCommunications  EventCommunicationRecord[] // æ¥æ”¶çš„æ´»åŠ¨é€šä¿¡è®°å½•

  // Volunteer system relations  
  volunteerRegistrations  EventVolunteerRegistration[]
  approvedVolunteers      EventVolunteerRegistration[] @relation("ApprovedVolunteers")
  rejectedVolunteers      EventVolunteerRegistration[] @relation("RejectedVolunteers")

  // Functional role system relations
  functionalRoleAssignments RoleAssignment[]

  // New template and project submission relations
  createdTemplates        EventTemplate[]
  projectSubmissions      EventProjectSubmission[]
  reviewedSubmissions     EventProjectSubmission[] @relation("ReviewedSubmissions")
  buildingRegistrations   BuildingRegistration[]
  checkInRecords          CheckInRecord[]
  checkInLikes            CheckInLike[]
  checkInComments         CheckInComment[]
  depositTransactions     DepositTransaction[]
  awardedProjects         ProjectAward[]
  createdAwards           Award[]
  
  // Level system relations
  levelApplications       LevelApplication[]
  reviewedLevelApplications LevelApplication[] @relation("ReviewedLevelApplications")
  
  
  // Customer service system relations
  customerServiceConfigs  CustomerServiceConfig[] // ç”¨æˆ·æ›´æ–°çš„å®¢æœé…ç½®
  
  // AI Recommendation system relations
  eventAIRecommendations  EventAIRecommendation[]
  recommendationFeedbacks RecommendationFeedback[]

  // Event participant interest system relations
  eventParticipantInterests    EventParticipantInterest[] @relation("InterestedByUsers") // æˆ‘å¯¹æ´»åŠ¨ä¸­çš„å…¶ä»–å‚ä¸è€…æ„Ÿå…´è¶£çš„è®°å½•
  eventParticipantInterestedBy EventParticipantInterest[] @relation("InterestedInUsers") // æ´»åŠ¨ä¸­å…¶ä»–å‚ä¸è€…å¯¹æˆ‘æ„Ÿå…´è¶£çš„è®°å½•

  // Event invite relations
  issuedEventInvites         EventInvite[] @relation("EventInviteIssuedBy")

  // Organization member invitation relations
  invitedMembers             Member[]       @relation("InvitedMembers") // æˆ‘é‚€è¯·åŠ å…¥çš„æˆå‘˜

  // NFC card relations
  boundNfcCards              NfcCard[]      @relation("BoundNfcCards") // ç»‘å®šçš„NFCå¡ç‰‡
  createdNfcCards            NfcCard[]      @relation("CreatedNfcCards") // åˆ›å»ºçš„NFCå¡ç‰‡

  @@map("user")
}

model Session {
  id                   String   @id @default(cuid())
  expiresAt            DateTime
  ipAddress            String?
  userAgent            String?
  userId               String
  impersonatedBy       String?
  activeOrganizationId String?
  token                String   @unique
  createdAt            DateTime
  updatedAt            DateTime
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  expiresAt             DateTime?
  password              String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([accountId, providerId]) // é˜²æ­¢åŒä¸€ providerId ä¸‹çš„ accountId é‡å¤
  @@map("account")
}

model Verification {
  id         String    @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Passkey {
  id           String    @id @default(cuid())
  name         String?
  publicKey    String
  userId       String
  credentialID String
  counter      Int
  deviceType   String
  backedUp     Boolean
  transports   String?
  createdAt    DateTime?
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("passkey")
}

model TwoFactor {
  id          String @id @default(cuid())
  secret      String
  backupCodes String
  userId      String
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("twoFactor")
}

model Organization {
  id                 String       @id @default(cuid())
  name               String
  slug               String       @unique
  logo               String?
  createdAt          DateTime
  metadata           String?
  paymentsCustomerId String?
  
  // Community organization fields
  summary          String?    // Brief one-line description of the organization
  description      String?    // Markdown format organization introduction
  location         String?    // Organization location/address (more flexible than city)
  tags             String[]   @default([]) // Organization tags
  audienceQrCode   String?    // Audience WeChat group QR code image URL
  memberQrCode     String?    // Member WeChat group QR code image URL
  contactInfo      String?    // Contact information (JSON format)
  
  // New visual fields
  coverImage       String?    // Organization cover/hero image for homepage
  isPublic         Boolean    @default(true) // Whether organization has a public page
  membershipRequirements String? // Requirements to join (Markdown format)
  
  aiChats            AiChat[]
  invitations        Invitation[]
  members            Member[]
  purchases          Purchase[]
  events             Event[]  // Events belonging to this organization
  contributions      Contribution[]  // Contributions under this organization
  tasks              CommunityTask[]  // Tasks belonging to this organization
  emailCampaigns     EmailCampaign[]  // Email campaigns belonging to this organization
  applications       OrganizationApplication[]  // Applications to join this organization
  invitationRequests OrganizationInvitationRequest[]
  eventHostSubscribers EventHostSubscription[]  // è®¢é˜…è¯¥ç»„ç»‡æ´»åŠ¨çš„ç”¨æˆ·

  // Functional role system relations
  functionalRoles     FunctionalRole[]
  roleAssignments     RoleAssignment[]

  // New template and award relations
  eventTemplates     EventTemplate[]  // Templates created by this organization
  awards             Award[]          // Awards created by this organization
  websites           Website[]        // Websites submitted by this organization

  
  @@map("organization")
}

model Member {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  role           String
  createdAt      DateTime
  invitedBy      String?      // é‚€è¯·äººID (nullè¡¨ç¤ºéé‚€è¯·åŠ å…¥)
  invitationId   String?      // å…³è”çš„é‚€è¯·ID
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  inviter        User?        @relation("InvitedMembers", fields: [invitedBy], references: [id], onDelete: SetNull)
  invitation     Invitation?  @relation("MemberInvitations", fields: [invitationId], references: [id], onDelete: SetNull)

  @@unique([organizationId, userId])
  @@index([userId]) // ä¼˜åŒ–ç”¨æˆ·ç»„ç»‡æŸ¥è¯¢
  @@index([invitedBy]) // ä¼˜åŒ–é‚€è¯·å…³ç³»æŸ¥è¯¢

  @@map("member")
}

model OrganizationApplication {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  reason         String       // ç”³è¯·ç†ç”±
  status         ApplicationStatus @default(PENDING)
  submittedAt    DateTime      @default(now())
  reviewedAt     DateTime?
  reviewedBy     String?
  reviewNote     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  invitationRequest OrganizationInvitationRequest? @relation("ApplicationInvitationRequest")
  reviewer       User?        @relation("ReviewedApplications", fields: [reviewedBy], references: [id])

  @@unique([organizationId, userId, status])
  @@map("organization_application")
}

model OrganizationInvitationRequest {
  id                 String       @id @default(cuid())
  code               String       @unique
  organizationId     String
  inviterId          String
  inviteeName        String
  invitationReason   String
  eligibilityDetails String
  status             OrganizationInvitationRequestStatus @default(PENDING)
  applicationId      String?      @unique
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  inviter      User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)
  application  OrganizationApplication? @relation("ApplicationInvitationRequest", fields: [applicationId], references: [id], onDelete: SetNull)

  @@index([organizationId])
  @@index([inviterId])
  @@index([applicationId])
  @@map("organization_invitation_request")
}

model Invitation {
  id             String       @id @default(cuid())
  organizationId String
  email          String
  role           String?
  status         String
  expiresAt      DateTime
  inviterId      String
  targetUserId   String?
  metadata       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  user           User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)
  targetUser     User?        @relation("InvitationTargetUser", fields: [targetUserId], references: [id], onDelete: SetNull)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  pendingUsers   User[]       @relation("PendingInvitation")
  members        Member[]     @relation("MemberInvitations") // é€šè¿‡æ­¤é‚€è¯·åŠ å…¥çš„æˆå‘˜

  @@map("invitation")
}

model Purchase {
  id             String        @id @default(cuid())
  organizationId String?
  userId         String?
  type           PurchaseType
  customerId     String
  subscriptionId String?       @unique
  productId      String
  status         String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User?         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@map("purchase")
}

model AiChat {
  id             String        @id @default(cuid())
  organizationId String?
  userId         String?
  title          String?
  /// [Array<{role: "user" | "assistant"; content: string;}>]
  /// @zod.custom.use(z.array(z.object({ role: z.enum(['user', 'assistant']), content: z.string() })))
  messages       Json          @default("[]")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User?         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_chat")
}



model Project {
  id              String            @id @default(cuid())
  userId          String
  title           String
  description     String?           // ä½œå“æè¿°ï¼ˆæ”¯æŒMarkdownï¼‰- å¯é€‰
  tagline         String?           // ä¸€å¥è¯ä»‹ç»
  url             String?
  featured        Boolean           @default(false)
  order           Int               @default(0)
  stage           ProjectStage      @default(IDEA_VALIDATION)
  
  // Enhanced fields
  subtitle            String?        // ä¸€å¥è¯ä»‹ç»ï¼ˆå¯é€‰ï¼‰
  screenshots         String[]      @default([]) // å¤šå¼ æˆªå›¾æ•°ç»„ï¼ˆå¯é€‰ï¼‰
  projectTags         String[]      @default([]) // ä½œå“æ ‡ç­¾ç³»ç»Ÿ
  pricingType         PricingType?  // å®šä»·ç±»å‹
  milestones          String[]      @default([]) // å·²å®Œæˆçš„é‡Œç¨‹ç¢‘
  demoVideoUrl        String?       // æ¼”ç¤ºè§†é¢‘é“¾æ¥
  
  // Team recruitment fields (independent of stage)
  isRecruiting        Boolean       @default(false) // æ˜¯å¦æ­£åœ¨æ‹›å‹Ÿå›¢é˜Ÿ
  recruitmentStatus   String?       // æ‹›å‹ŸçŠ¶æ€è¯´æ˜
  recruitmentTags     String[]      @default([]) // æ‹›å‹Ÿå²—ä½æ ‡ç­¾ï¼Œå¦‚ #å¯»æ±‚è”åˆåˆ›å§‹äºº #æ‹›å‹ŸæŠ€æœ¯åˆä¼™äºº ç­‰
  teamDescription     String?       // éœ€è¦ä»€ä¹ˆæ ·çš„åˆä¼™äººï¼Œè¯¦ç»†è¯´æ˜
  teamSkills          String[]      @default([]) // Required skills for team members  
  teamSize            Int?          // Desired team size
  contactInfo         String?       // è”ç³»æ–¹å¼
  
  // Creation experience sharing (optional markdown content)
  creationExperience String?        // åˆ›ä½œç»éªŒåˆ†äº«ï¼Œæ”¯æŒ Markdown
  
  // Project completion tracking
  isComplete      Boolean           @default(false) // æ˜¯å¦ä¸ºé«˜å®Œæˆåº¦ä½œå“ï¼ˆç¤¾åŒºå±•ç¤ºï¼‰
  completionScore Int               @default(0) // ä½œå“å®Œæˆåº¦è¯„åˆ† (0-100)
  communityUseAuth Boolean          @default(false)
  customFields    Json?
  isSubmission    Boolean           @default(false)
  submittedAt     DateTime?
  
  // Analytics
  viewCount       Int               @default(0)
  likeCount       Int               @default(0)
  commentCount    Int               @default(0)
  
  // Activity related statistics
  submissionCount Int               @default(0) // æäº¤æ¬¡æ•°
  awardCount      Int               @default(0) // è·å¥–æ¬¡æ•°
  
  // Hackathon specific fields
  githubUrl       String?           // GitHub repository URL
  slidesUrl       String?           // Online slides URL (Tencent Docs, Feishu, etc.)
  inspiration     String?           // Inspiration source and project background
  challenges      String?           // Technical challenges encountered during development
  learnings       String?           // New skills and experiences learned
  nextSteps       String?           // Future development plans
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Relations
  likes           ProjectLike[]
  comments        ProjectComment[]
  bookmarks       ProjectBookmark[]
  members         ProjectMember[]      // Team members
  
  // New activity and award relations
  eventSubmissions EventProjectSubmission[]
  buildingRegistrations BuildingRegistration[]
  awards          ProjectAward[]
  votes           ProjectVote[]
  attachments     ProjectAttachment[]

  
  @@map("project")
}

model ProjectMember {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  role      String   @default("MEMBER") // 'LEADER' | 'MEMBER'
  joinedAt  DateTime @default(now())
  
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([projectId, userId])
  @@map("project_member")
}

model ProjectAttachment {
  id        String   @id @default(cuid())
  projectId String
  fileName  String
  fileUrl   String
  fileType  String
  mimeType  String?
  fileSize  Int
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_attachment")
}

model ProjectVote {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  eventId   String
  createdAt DateTime @default(now())

  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId, eventId])
  @@index([projectId])
  @@index([userId])
  @@index([eventId])
  @@map("project_vote")
}

model ProjectLike {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  createdAt DateTime @default(now())
  
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([projectId, userId]) // One like per user per project
  @@map("project_like")
}

model ProjectBookmark {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  createdAt DateTime @default(now())
  
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([projectId, userId]) // é˜²æ­¢é‡å¤æ”¶è—
  @@map("project_bookmark")
}

// Universal Comment System
model Comment {
  id          String      @id @default(cuid())
  content     String      // è¯„è®ºå†…å®¹
  userId      String      // è¯„è®ºè€…ID
  
  // é€šç”¨çš„å…³è”å­—æ®µ
  entityType  CommentEntityType // è¯„è®ºçš„å®ä½“ç±»å‹
  entityId    String      // å®ä½“ID
  
  // å›å¤åŠŸèƒ½
  parentId    String?     // çˆ¶è¯„è®ºIDï¼Œç”¨äºå›å¤
  replyToId   String?     // ç›´æ¥å›å¤çš„è¯„è®ºIDï¼Œç”¨äº @username
  
  // çŠ¶æ€ç®¡ç†
  status      CommentStatus @default(ACTIVE)
  isDeleted   Boolean     @default(false)
  deletedAt   DateTime?
  deletedBy   String?     // åˆ é™¤è€…IDï¼ˆç®¡ç†å‘˜æˆ–ä½œè€…è‡ªå·±ï¼‰
  
  // ç»Ÿè®¡æ•°æ®
  likeCount   Int         @default(0)
  replyCount  Int         @default(0)
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent      Comment?    @relation("CommentReplies", fields: [parentId], references: [id])
  replies     Comment[]   @relation("CommentReplies")
  replyTo     Comment?    @relation("CommentDirectReplies", fields: [replyToId], references: [id])
  directReplies Comment[] @relation("CommentDirectReplies")
  deleter     User?       @relation("DeletedComments", fields: [deletedBy], references: [id])
  likes       CommentLike[]

  // ç´¢å¼•ä¼˜åŒ–
  @@index([entityType, entityId, createdAt])
  @@index([parentId])
  @@index([userId])
  @@index([status])
    @@map("comment")
}

model CommentLike {
  id        String   @id @default(cuid())
  commentId String
  userId    String
  createdAt DateTime @default(now())
  
  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([commentId, userId]) // é˜²æ­¢é‡å¤ç‚¹èµ
  @@map("comment_like")
}

enum CommentEntityType {
  PROJECT     // ä½œå“è¯„è®º
  EVENT       // æ´»åŠ¨è¯„è®º  
  TASK        // ä»»åŠ¡è¯„è®º
  ARTICLE     // æ–‡ç« è¯„è®ºï¼ˆé¢„ç•™ï¼‰
  ORGANIZATION // ç»„ç»‡è¯„è®ºï¼ˆé¢„ç•™ï¼‰
}

enum CommentStatus {
  ACTIVE      // æ­£å¸¸æ˜¾ç¤º
  HIDDEN      // éšè—ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰
  REVIEWING   // å®¡æ ¸ä¸­
  REJECTED    // è¢«æ‹’ç»
}

// ä¿æŒå‘åå…¼å®¹çš„ProjectCommentæ¨¡å‹
model ProjectComment {
  id        String   @id @default(cuid())
  projectId String
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("project_comment")
}

enum PurchaseType {
  SUBSCRIPTION
  ONE_TIME
}

enum Gender {
  MALE
  FEMALE
  OTHER
  NOT_SPECIFIED
}

enum ProjectStage {
  IDEA_VALIDATION    // ğŸ’¡ æƒ³æ³•éªŒè¯ - æ¦‚å¿µæ„æ€ã€å¸‚åœºè°ƒç ”ã€å¯è¡Œæ€§åˆ†æã€å›¢é˜Ÿç»„å»ºã€åˆä¼™äººå¯»æ‰¾
  DEVELOPMENT        // ğŸ”§ äº§å“å¼€å‘ - åŸå‹åˆ¶ä½œã€MVPå¼€å‘ã€äº§å“è¿­ä»£ã€æŠ€æœ¯æ¶æ„æ­å»ºã€æ ¸å¿ƒåŠŸèƒ½å®ç°
  LAUNCH             // ğŸš€ äº§å“å‘å¸ƒ - äº§å“æ­£å¼å‘å¸ƒã€åˆæœŸç”¨æˆ·è·å–ã€å¸‚åœºéªŒè¯ã€ç”¨æˆ·åé¦ˆæ”¶é›†
  GROWTH             // ğŸ“ˆ ç”¨æˆ·å¢é•¿ - ç”¨æˆ·è§„æ¨¡æ‰©å¼ ã€äº§å“ä¼˜åŒ–è¿­ä»£ã€è¿è¥ç­–ç•¥æ‰§è¡Œã€å¸‚åœºæ¨å¹¿
  MONETIZATION       // ğŸ’° å•†ä¸šå˜ç° - ç›ˆåˆ©æ¨¡å¼éªŒè¯ã€æ”¶å…¥å¢é•¿ã€å•†ä¸šæ¨¡å¼ä¼˜åŒ–ã€ä»˜è´¹ç”¨æˆ·è½¬åŒ–
  FUNDING            // ğŸ’¼ èèµ„æ‰©å¼  - å¯»æ±‚æŠ•èµ„ã€èèµ„è°ˆåˆ¤ã€å›¢é˜Ÿæ‰©å¼ ã€ä¸šåŠ¡è§„æ¨¡åŒ–
  COMPLETED          // ğŸ¯ ä½œå“å®Œç»“ - æˆåŠŸé€€å‡ºã€è¢«æ”¶è´­ã€è½¬å‹ã€ä½œå“æš‚åœã€å½’æ¡£æˆ–å¤±è´¥æ€»ç»“
}

enum PricingType {
  FREE
  PAID
  FREEMIUM
}

// Event System Models

model Event {
  id              String      @id @default(cuid())
  title           String      // Event title
  shortDescription String?    // Short description for Hero section (optional)
  richContent     String?     // Rich text HTML content
  contentImages   String[]    @default([]) // Image URLs in content
  
  // Basic information
  organizerId     String      // Organizer ID
  type            EventType   // Event type
  status          EventStatus @default(DRAFT) // Event status
  
  // Time information
  startTime       DateTime    // Start time
  endTime         DateTime    // End time
  timezone        String      @default("Asia/Shanghai") // Timezone
  
  // Location information
  isOnline        Boolean     @default(false) // Is online event
  address         String?     // Event location (offline address or online URL)
  organizationId  String?     // Organization ID (uses better-auth organization)
  onlineUrl       String?     // Online event link (optional for online events)
  
  // External event support
  isExternalEvent Boolean     @default(false) // Is external platform event
  externalUrl     String?     // External registration link
  
  // Registration settings
  maxAttendees    Int?        // Maximum participants (null means unlimited)
  registrationDeadline DateTime? // Registration deadline
  requireApproval Boolean     @default(false) // Requires approval
  registrationSuccessInfo String?     // Information shown after successful registration
  registrationSuccessImage String?    // Image shown after successful registration
  registrationPendingInfo String?     // Information shown during approval process
  registrationPendingImage String?    // Image shown during approval process
  
  // Display settings
  coverImage      String?     // Cover image
  tags            String[]    // Event tags
  featured        Boolean     @default(false) // Is featured
  
  // Volunteer settings
  volunteerContactInfo  String?   // Global volunteer contact info
  volunteerWechatQrCode String?   // Global volunteer WeChat QR code
  
  // Organizer contact settings
  organizerContact      String?   // Organizer contact info (email, wechat, phone, etc.)
  
  // Template and project submission settings
  templateId      String?                 // ä½¿ç”¨çš„æ¨¡æ¿ID
  requireProjectSubmission Boolean        @default(false) // æ˜¯å¦éœ€è¦ä½œå“æäº¤
  projectSubmissionDeadline DateTime?     // ä½œå“æäº¤æˆªæ­¢æ—¶é—´
  askDigitalCardConsent Boolean           @default(false) // æ˜¯å¦è¯¢é—®ç”¨æˆ·æ˜¯å¦æ„¿æ„åœ¨ç°åœºå±å¹•å…¬å¼€æ•°å­—åç‰‡
  
  // Hackathon specific configuration
  hackathonConfig Json?                   // Hackathon configuration (JSON format)

  // Feedback configuration
  feedbackConfig Json?                    // Custom feedback questions configuration (JSON format)
  
  // Statistics
  viewCount       Int         @default(0) // View count
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  // Relations
  organizer       User        @relation("OrganizedEvents", fields: [organizerId], references: [id])
  organization    Organization? @relation(fields: [organizationId], references: [id])
  registrations   EventRegistration[]
  questions       EventQuestion[]
  answers         EventAnswer[]
  checkIns        EventCheckIn[]
  feedbacks       EventFeedback[]
  ticketTypes     EventTicketType[]
  photos          EventPhoto[]
  admins          EventAdmin[]
  volunteerRoles  EventVolunteerRole[]
  volunteerRegistrations EventVolunteerRegistration[]
  
  // New template and project submission relations
  template        EventTemplate?          @relation(fields: [templateId], references: [id])
  createdFromTemplates EventTemplate[]     @relation("EventToTemplate")
  projectSubmissions EventProjectSubmission[]
  buildingConfig  BuildingActivityConfig?
  buildingRegistrations BuildingRegistration[]
  checkInRecords  CheckInRecord[]
  projectAwards   ProjectAward[]
  projectVotes    ProjectVote[]
  bookmarks       EventBookmark[]  // æ”¶è—è¿™ä¸ªæ´»åŠ¨çš„ç”¨æˆ·
  likes           EventLike[]      // ç‚¹èµè¿™ä¸ªæ´»åŠ¨çš„ç”¨æˆ·
  invites        EventInvite[]
  communications  EventCommunication[] // æ´»åŠ¨çš„æ²Ÿé€šè®°å½•
  communicationRecords EventCommunicationRecord[] // æ´»åŠ¨çš„å…·ä½“é€šä¿¡è®°å½•
  
  // AI Recommendation system
  aiRecommendations    EventAIRecommendation[]

  // Event participant interest system
  participantInterests EventParticipantInterest[]

  // åªæ·»åŠ æœ€å…³é”®çš„ç´¢å¼•
  @@index([status, startTime]) // ä¸»è¦æŸ¥è¯¢ï¼šæŒ‰çŠ¶æ€å’Œæ—¶é—´æ’åº
  @@index([featured, startTime]) // ç½®é¡¶æ´»åŠ¨æŸ¥è¯¢

  @@map("event")
}

model EventTicketType {
  id              String              @id @default(cuid())
  eventId         String
  name            String              // ç¥¨ç§åç§°
  description     String?             // ç¥¨ç§è¯´æ˜
  price           Float?              // ä»·æ ¼ï¼ˆå¯é€‰ï¼Œå…è´¹æ´»åŠ¨ä¸ºnullï¼‰
  maxQuantity     Int?                // æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆnullè¡¨ç¤ºæ— é™åˆ¶ï¼‰
  currentQuantity Int                 @default(0) // å½“å‰å·²å”®æ•°é‡
  isActive        Boolean             @default(true) // æ˜¯å¦å¯ç”¨
  sortOrder       Int                 @default(0) // æ’åº
  
  // Timestamps
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  registrations   EventRegistration[]
  
  @@map("event_ticket_type")
}

model EventPhoto {
  id              String              @id @default(cuid())
  eventId         String
  userId          String              // ä¸Šä¼ è€…
  imageUrl        String              // åŸå§‹å›¾ç‰‡URL
  watermarkedUrl  String?             // åŠ æ°´å°åçš„å›¾ç‰‡URL
  caption         String?             // å›¾ç‰‡è¯´æ˜
  isApproved      Boolean             @default(true) // æ˜¯å¦é€šè¿‡å®¡æ ¸

  // Timestamps
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("event_photo")
}

// Event Admin System
model EventAdmin {
  id              String              @id @default(cuid())
  eventId         String
  userId          String?             // null if invitation is pending
  email           String              // Email for invitation
  role            EventAdminRole      @default(ADMIN)
  status          EventAdminStatus    @default(PENDING)
  
  // Invitation information
  invitedBy       String              // User who sent the invitation
  invitedAt       DateTime            @default(now())
  acceptedAt      DateTime?           // When invitation was accepted
  
  // Permission settings
  canEditEvent    Boolean             @default(true)  // Can edit event details
  canManageRegistrations Boolean      @default(true)  // Can approve/reject registrations
  canManageAdmins Boolean             @default(false) // Can invite/remove other admins (only for SUPER_ADMIN)
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User?               @relation("EventAdmins", fields: [userId], references: [id], onDelete: Cascade)
  inviter         User                @relation("EventAdminInvitations", fields: [invitedBy], references: [id], onDelete: Cascade)
  
  @@unique([eventId, email]) // One invitation per email per event
  @@index([eventId, status])
  @@index([userId])
  @@map("event_admin")
}

model EventRegistration {
  id              String              @id @default(cuid())
  eventId         String
  userId          String
  ticketTypeId    String?             // å…³è”ç¥¨ç§
  inviteId        String?
  status          RegistrationStatus  @default(PENDING)
  
  // Registration information
  registeredAt    DateTime            @default(now())
  note            String?             // Registration note
  allowDigitalCardDisplay Boolean?    // æ˜¯å¦æ„¿æ„åœ¨ç°åœºå±å¹•å…¬å¼€æ•°å­—åç‰‡
  
  // Review information (if approval required)
  reviewedAt      DateTime?
  reviewedBy      String?
  reviewNote      String?
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  ticketType      EventTicketType?    @relation(fields: [ticketTypeId], references: [id])
  invite          EventInvite?        @relation(fields: [inviteId], references: [id], onDelete: SetNull)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewer        User?               @relation("ReviewedRegistrations", fields: [reviewedBy], references: [id])
  answers         EventAnswer[]
  
  @@unique([eventId, userId]) // Same user cannot register for same event twice
  @@index([inviteId])
  @@index([eventId, status]) // æ´»åŠ¨æŠ¥åçŠ¶æ€æŸ¥è¯¢ä¼˜åŒ–
  @@index([userId, status]) // ç”¨æˆ·æŠ¥åçŠ¶æ€æŸ¥è¯¢ä¼˜åŒ–
  @@index([status, registeredAt]) // æŒ‰çŠ¶æ€å’Œæ—¶é—´æ’åº
  @@map("event_registration")
}

model EventQuestion {
  id          String        @id @default(cuid())
  eventId     String
  question    String        // Question content
  description String?       // Question description (optional)
  type        QuestionType  // Question type
  options     String[]      // Options (for single/multiple choice)
  required    Boolean       @default(false) // Is required
  order       Int           // Display order
  
  event       Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  answers     EventAnswer[]

  @@map("event_question")
}

model EventAnswer {
  id             String              @id @default(cuid())
  questionId     String
  userId         String
  eventId        String
  registrationId String
  answer         String              // Answer text
  
  question       EventQuestion       @relation(fields: [questionId], references: [id], onDelete: Cascade)
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  event          Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  registration   EventRegistration   @relation(fields: [registrationId], references: [id], onDelete: Cascade)
  
  @@unique([questionId, userId]) // Same user can only answer same question once
  @@index([eventId, registrationId]) // å¯¼å‡ºæŸ¥è¯¢ä¼˜åŒ–
  @@index([questionId, eventId]) // æŒ‰é—®é¢˜æŸ¥è¯¢ç­”æ¡ˆ
  @@map("event_answer")
}

model EventCheckIn {
  id              String    @id @default(cuid())
  eventId         String
  userId          String
  checkedInAt     DateTime  @default(now())
  checkedInBy     String?   // Check-in operator (might be organizer checking in for user)
  
  // Relations
  event           Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  operator        User?     @relation("CheckInOperations", fields: [checkedInBy], references: [id])
  
  @@unique([eventId, userId]) // Same user can only check in once per event
  @@map("event_checkin")
}

model EventFeedback {
  id              String    @id @default(cuid())
  eventId         String
  userId          String
  rating          Int       // 1-5 star rating
  comment         String?   // Text feedback
  suggestions     String?   // Improvement suggestions
  wouldRecommend  Boolean   // Would recommend
  customAnswers   Json?     // Custom feedback question answers (JSON format)
  createdAt       DateTime  @default(now())

  event           Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId]) // Each person can only give feedback once per event
  @@map("event_feedback")
}

model EventInvite {
  id             String            @id @default(cuid())
  eventId        String
  code           String            @unique
  type           EventInviteType   @default(USER_SHARE)
  label          String?
  issuedByUserId String?
  createdAt      DateTime          @default(now())
  lastUsedAt     DateTime?

  event          Event             @relation(fields: [eventId], references: [id], onDelete: Cascade)
  issuedByUser   User?             @relation("EventInviteIssuedBy", fields: [issuedByUserId], references: [id], onDelete: SetNull)
  registrations  EventRegistration[]

  @@index([eventId])
  @@index([issuedByUserId])
  @@map("event_invite")
}

enum EventType {
  MEETUP          // Regular Event/Meetup 
  HACKATHON       // Hackathon
  BUILDING_PUBLIC // Building Public Challenge
}

enum EventStatus {
  DRAFT           // Draft
  PUBLISHED       // Published
  REGISTRATION_CLOSED // Registration Closed
  ONGOING         // Ongoing
  COMPLETED       // Completed
  CANCELLED       // Cancelled
}

enum RegistrationStatus {
  PENDING         // Pending (if approval required)
  APPROVED        // Approved (auto-approved if no manual approval required)
  WAITLISTED      // Waitlisted
  REJECTED        // Rejected
  CANCELLED       // Cancelled
}

enum EventInviteType {
  USER_SHARE
  CHANNEL
}

enum QuestionType {
  TEXT        // Short text input
  TEXTAREA    // Long text input
  SELECT      // Dropdown selection
  CHECKBOX    // Multiple choice (checkboxes)
  RADIO       // Single choice (radio buttons)
}

// Contribution System Models

model Contribution {
  id             String              @id @default(cuid())
  userId         String
  type           ContributionType
  category       String              // è´¡çŒ®åˆ†ç±»ï¼ˆæ´»åŠ¨ã€ä½œå“ã€å†…å®¹ç­‰ï¼‰
  description    String              // è´¡çŒ®æè¿°
  cpValue        Int                 // è´¡çŒ®ç‚¹æ•°å€¼
  sourceId       String?             // å…³è”çš„æºå¯¹è±¡IDï¼ˆå¦‚eventId, projectIdï¼‰
  sourceType     String?             // æºå¯¹è±¡ç±»å‹
  isAutomatic    Boolean             // æ˜¯å¦è‡ªåŠ¨è®°å½•
  status         ContributionStatus  @default(APPROVED)
  
  // å®¡æ ¸ä¿¡æ¯ï¼ˆæ‰‹åŠ¨ç”³æŠ¥æ—¶ä½¿ç”¨ï¼‰
  organizationId String?             // æ‰€å±ç»„ç»‡IDï¼ˆç”¨äºåˆ†éƒ¨ç®¡ç†ï¼‰
  reviewedBy     String?
  reviewedAt     DateTime?
  reviewNote     String?
  evidence       String?             // è¯æ®é“¾æ¥æˆ–è¯´æ˜
  
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  
  // Relations
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewer       User?               @relation("ReviewedContributions", fields: [reviewedBy], references: [id])
  organization   Organization?       @relation(fields: [organizationId], references: [id])
  
  @@map("contribution")
}

model Badge {
  id             String      @id @default(cuid())
  name           String      // å‹‹ç« åç§°
  description    String      // å‹‹ç« æè¿°
  iconUrl        String?     // å‹‹ç« å›¾æ ‡URL
  color          String?     // å‹‹ç« é¢œè‰² (hex color code)
  rarity         BadgeRarity // ç¨€æœ‰åº¦ï¼ˆæ™®é€š/ä¸å‡¡/ç¨€æœ‰/å²è¯—/ä¼ å¥‡ï¼‰
  isActive       Boolean     @default(true)
  isAutoAwarded  Boolean     @default(false) // æ˜¯å¦è‡ªåŠ¨é¢å‘
  conditions     Json?       // è‡ªåŠ¨é¢å‘æ¡ä»¶ (JSONæ ¼å¼)
  
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  
  // Relations
  userBadges     UserBadge[]
  
  @@map("badge")
}

model UserBadge {
  id        String    @id @default(cuid())
  userId    String
  badgeId   String
  awardedBy String?   // é¢å‘è€…ID
  reason    String?   // è·å¾—åŸå› 
  awardedAt DateTime  @default(now())
  expiresAt DateTime? // æœ‰æ•ˆæœŸï¼ˆå¯é€‰ï¼‰
  
  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge     Badge     @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  awarder   User?     @relation("AwardedBadges", fields: [awardedBy], references: [id])
  
  @@unique([userId, badgeId]) // é˜²æ­¢é‡å¤é¢å‘
  @@map("user_badge")
}

enum ContributionType {
  EVENT_CHECKIN        // æ´»åŠ¨ç­¾åˆ°
  EVENT_FEEDBACK       // æ´»åŠ¨åé¦ˆ
  EVENT_ORGANIZATION   // æ´»åŠ¨ç»„ç»‡
  PROJECT_CREATION     // ä½œå“åˆ›å»º
  PROJECT_UPDATE       // ä½œå“æ›´æ–°
  PROJECT_LIKE         // è·å¾—ç‚¹èµ
  COMMENT_CREATION     // å‘è¡¨è¯„è®º
  PROFILE_COMPLETION   // å®Œå–„èµ„æ–™
  CONTENT_CREATION     // å†…å®¹åˆ›ä½œ
  COMMUNITY_SERVICE    // ç¤¾åŒºæœåŠ¡
  RESOURCE_INTRODUCTION // èµ„æºå¼•å…¥
  COMMUNITY_BUILDING   // ç¤¾åŒºå»ºè®¾
  VOLUNTEER_SERVICE    // å¿—æ„¿è€…æœåŠ¡
  OTHER               // å…¶ä»–
}

enum ContributionStatus {
  PENDING    // å¾…å®¡æ ¸
  APPROVED   // å·²æ‰¹å‡†
  REJECTED   // å·²æ‹’ç»
  REVISED    // å·²ä¿®è®¢
}

enum BadgeRarity {
  COMMON    // æ™®é€š
  UNCOMMON  // ä¸å‡¡
  RARE      // ç¨€æœ‰
  EPIC      // å²è¯—
  LEGENDARY // ä¼ å¥‡
}

// Admin System Models

model AdminLog {
  id         String   @id @default(cuid())
  adminId    String   // ç®¡ç†å‘˜ID
  action     String   // æ“ä½œç±»å‹
  targetType String   // æ“ä½œå¯¹è±¡ç±»å‹ (user/contribution/badgeç­‰)
  targetId   String   // æ“ä½œå¯¹è±¡ID
  details    Json     // æ“ä½œè¯¦æƒ…
  createdAt  DateTime @default(now())
  
  admin      User     @relation(fields: [adminId], references: [id], onDelete: Cascade)
  
  @@map("admin_log")
}

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique // é…ç½®é¡¹åç§°
  value       Json     // é…ç½®å€¼
  description String?  // é…ç½®æè¿°
  updatedBy   String   // æ›´æ–°è€…ID
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
  
  updater     User     @relation(fields: [updatedBy], references: [id], onDelete: Cascade)
  
  @@map("system_config")
}

// Community Task System Models

model CommunityTask {
  id              String              @id @default(cuid())
  title           String              // ä»»åŠ¡æ ‡é¢˜
  description     String              // ä»»åŠ¡æè¿° (æ”¯æŒMarkdown)
  category        TaskCategory        // ä»»åŠ¡åˆ†ç±»
  cpReward        Int                 // CPå¥–åŠ±å€¼
  status          TaskStatus          @default(PUBLISHED)
  deadline        DateTime?           // æˆªæ­¢æ—¶é—´
  
  // å‘å¸ƒä¿¡æ¯
  publisherId     String              // å‘å¸ƒè€…ID
  organizationId  String?             // æ‰€å±ç»„ç»‡IDï¼ˆnullè¡¨ç¤ºå…¨å±€ä»»åŠ¡ï¼‰
  isUserTask      Boolean             @default(false) // æ˜¯å¦ä¸ºç”¨æˆ·å‘å¸ƒçš„ä»»åŠ¡
  
  // è®¤é¢†ä¿¡æ¯
  assigneeId      String?             // è®¤é¢†è€…ID
  claimedAt       DateTime?           // è®¤é¢†æ—¶é—´
  
  // å®Œæˆä¿¡æ¯
  submittedAt     DateTime?           // æäº¤æ—¶é—´
  submissionNote  String?             // æäº¤è¯´æ˜
  evidenceUrls    String[]            // è¯æ®é“¾æ¥
  
  // å®¡æ ¸ä¿¡æ¯
  reviewedAt      DateTime?           // å®¡æ ¸æ—¶é—´
  reviewNote      String?             // å®¡æ ¸å¤‡æ³¨
  
  // æ ‡ç­¾å’Œä¼˜å…ˆçº§
  tags            String[]            @default([])     // ä»»åŠ¡æ ‡ç­¾
  priority        TaskPriority        @default(NORMAL) // ä»»åŠ¡ä¼˜å…ˆçº§
  featured        Boolean             @default(false)  // æ˜¯å¦ç²¾é€‰ä»»åŠ¡
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  publisher       User                @relation("PublishedTasks", fields: [publisherId], references: [id])
  assignee        User?               @relation("AssignedTasks", fields: [assigneeId], references: [id])
  organization    Organization?       @relation(fields: [organizationId], references: [id])
  
  @@map("community_task")
}

enum TaskCategory {
  COMMUNITY_SERVICE   // ç¤¾åŒºæœåŠ¡
  CONTENT_CREATION    // å†…å®¹åˆ›ä½œ
  PRODUCT_TECH        // äº§å“æŠ€æœ¯
  OPERATION_PROMOTION // è¿è¥æ¨å¹¿
  OTHER              // å…¶ä»–
}

enum TaskStatus {
  PUBLISHED   // å·²å‘å¸ƒ
  CLAIMED     // å·²è®¤é¢†
  SUBMITTED   // å·²æäº¤
  COMPLETED   // å·²å®Œæˆ
  REJECTED    // å·²æ‹’ç»
  CANCELLED   // å·²å–æ¶ˆ
}

enum TaskPriority {
  LOW         // ä½ä¼˜å…ˆçº§
  NORMAL      // æ™®é€š
  HIGH        // é«˜ä¼˜å…ˆçº§
  URGENT      // ç´§æ€¥
}

// Email System Models

model EmailCampaign {
  id              String           @id @default(cuid())
  title           String           // æ´»åŠ¨æ ‡é¢˜
  description     String?          // æ´»åŠ¨æè¿°
  type            EmailCampaignType // é‚®ä»¶ç±»å‹
  scope           EmailScope       // é‚®ä»¶èŒƒå›´
  organizationId  String?          // ç»„ç»‡IDï¼Œnullè¡¨ç¤ºå…¨ç«™é‚®ä»¶
  createdBy       String           // åˆ›å»ºè€…ID
  
  templateId      String           // æ¨¡æ¿ID
  subject         String           // é‚®ä»¶ä¸»é¢˜
  content         Json             // é‚®ä»¶å†…å®¹é…ç½®
  
  status          CampaignStatus   // æ´»åŠ¨çŠ¶æ€
  scheduledAt     DateTime?        // è®¡åˆ’å‘é€æ—¶é—´
  sentAt          DateTime?        // å®é™…å‘é€æ—¶é—´
  
  // å—ä¼—é…ç½®
  /// [Object]
  /// @zod.custom.use(z.object({}))
  audienceConfig  Json             // å—ä¼—ç­›é€‰æ¡ä»¶
  recipientCount  Int              @default(0) // æ”¶ä»¶äººæ•°é‡
  
  // ç»Ÿè®¡æ•°æ®
  sentCount       Int              @default(0) // å·²å‘é€æ•°é‡
  deliveredCount  Int              @default(0) // æˆåŠŸæŠ•é€’æ•°é‡
  openedCount     Int              @default(0) // æ‰“å¼€æ•°é‡
  clickedCount    Int              @default(0) // ç‚¹å‡»æ•°é‡
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  organization    Organization?    @relation(fields: [organizationId], references: [id])
  creator         User             @relation(fields: [createdBy], references: [id])
  jobs            EmailJob[]
  
  @@map("email_campaign")
}

model EmailJob {
  id            String      @id @default(cuid())
  campaignId    String      // æ‰€å±æ´»åŠ¨ID
  recipient     String      // æ”¶ä»¶äººé‚®ç®±
  userId        String?     // ç”¨æˆ·IDï¼ˆå¦‚æœæ˜¯æ³¨å†Œç”¨æˆ·ï¼‰
  
  status        JobStatus   // ä»»åŠ¡çŠ¶æ€
  scheduledAt   DateTime    // è®¡åˆ’å‘é€æ—¶é—´
  sentAt        DateTime?   // å®é™…å‘é€æ—¶é—´
  deliveredAt   DateTime?   // æŠ•é€’ç¡®è®¤æ—¶é—´
  openedAt      DateTime?   // é¦–æ¬¡æ‰“å¼€æ—¶é—´
  clickedAt     DateTime?   // é¦–æ¬¡ç‚¹å‡»æ—¶é—´
  
  errorMessage  String?     // é”™è¯¯ä¿¡æ¯
  retryCount    Int         @default(0) // é‡è¯•æ¬¡æ•°
  
  // ä¸ªæ€§åŒ–æ•°æ®
  /// [Object]
  /// @zod.custom.use(z.object({}))
  context       Json        // ä¸ªæ€§åŒ–å†…å®¹ä¸Šä¸‹æ–‡
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  campaign      EmailCampaign @relation(fields: [campaignId], references: [id])
  user          User?         @relation(fields: [userId], references: [id])
  
  @@map("email_job")
}

model UserEmailPreference {
  id                    String   @id @default(cuid())
  userId                String   @unique
  
  // è®¢é˜…è®¾ç½®
  subscribeNewsletter   Boolean  @default(true)   // è®¢é˜…å‘¨æŠ¥
  subscribeMarketing    Boolean  @default(true)   // è®¢é˜…è¥é”€é‚®ä»¶
  subscribeNotification Boolean  @default(true)   // è®¢é˜…é€šçŸ¥é‚®ä»¶
  subscribeEvents       Boolean  @default(true)   // è®¢é˜…æ´»åŠ¨é‚®ä»¶
  
  // ç»„ç»‡é‚®ä»¶è®¾ç½®
  /// [Object]
  /// @zod.custom.use(z.object({}))
  organizationEmails    Json     @default("{}") // å„ç»„ç»‡é‚®ä»¶è®¢é˜…è®¾ç½®
  
  // é€€è®¢è®°å½•
  unsubscribedAt        DateTime? // å…¨å±€é€€è®¢æ—¶é—´
  unsubscribeToken      String?   @unique // é€€è®¢ä»¤ç‰Œ
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  user                  User     @relation(fields: [userId], references: [id])
  
  @@map("user_email_preference")
}

model EventHostSubscription {
  id             String   @id @default(cuid())
  userId         String
  organizationId String?
  hostUserId     String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  unsubscribedAt DateTime?

  user         User         @relation("UserEventHostSubscriptions", fields: [userId], references: [id], onDelete: Cascade)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  hostUser     User?        @relation("EventHostFollowers", fields: [hostUserId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([organizationId])
  @@index([hostUserId])
  @@unique([userId, organizationId])
  @@unique([userId, hostUserId])
  @@map("event_host_subscription")
}

enum EmailCampaignType {
  NEWSLETTER     // å‘¨æŠ¥/æ–°é—»é€šè®¯
  NOTIFICATION   // é€šçŸ¥é‚®ä»¶
  MARKETING      // è¥é”€é‚®ä»¶
  SYSTEM         // ç³»ç»Ÿé‚®ä»¶
  ANNOUNCEMENT   // å…¬å‘Šé‚®ä»¶
}

enum EmailScope {
  GLOBAL         // å…¨ç«™é‚®ä»¶
  ORGANIZATION   // ç»„ç»‡é‚®ä»¶
}

enum CampaignStatus {
  DRAFT
  SCHEDULED  
  SENDING
  COMPLETED
  CANCELLED
  FAILED
}

enum JobStatus {
  PENDING
  PROCESSING
  SENT
  DELIVERED
  OPENED
  CLICKED
  FAILED
  CANCELLED
}

// User Follow System (å…³æ³¨ç³»ç»Ÿ)
model UserFollow {
  id           String   @id @default(cuid())
  followerId   String   // å…³æ³¨è€…
  followingId  String   // è¢«å…³æ³¨çš„ç”¨æˆ·
  createdAt    DateTime @default(now())
  
  // Relations
  follower     User     @relation(fields: [followerId], references: [id], onDelete: Cascade)
  following    User     @relation("Followers", fields: [followingId], references: [id], onDelete: Cascade)
  
  @@unique([followerId, followingId]) // é˜²æ­¢é‡å¤å…³æ³¨
  @@index([followerId]) // äº’å…³å¥½å‹æŸ¥è¯¢ä¼˜åŒ–ï¼šæˆ‘å…³æ³¨çš„äºº
  @@index([followingId]) // äº’å…³å¥½å‹æŸ¥è¯¢ä¼˜åŒ–ï¼šå…³æ³¨æˆ‘çš„äºº
  @@map("user_follow")
}

// Event Bookmark Model
model EventBookmark {
  id        String   @id @default(cuid())
  userId    String   // æ”¶è—è€…
  eventId   String   // è¢«æ”¶è—çš„æ´»åŠ¨
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@unique([userId, eventId]) // é˜²æ­¢é‡å¤æ”¶è—
  @@map("event_bookmark")
}

// User Like System - ç”¨æˆ·ç‚¹èµç³»ç»Ÿ
model UserLike {
  id        String   @id @default(cuid())
  userId    String   // ç‚¹èµè€…
  likedUserId String // è¢«ç‚¹èµçš„ç”¨æˆ·
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  likedUser User     @relation("LikedUsers", fields: [likedUserId], references: [id], onDelete: Cascade)
  
  @@unique([userId, likedUserId]) // é˜²æ­¢é‡å¤ç‚¹èµ
  @@map("user_like")
}

// Event Like System - æ´»åŠ¨ç‚¹èµç³»ç»Ÿ
model EventLike {
  id        String   @id @default(cuid())
  userId    String   // ç‚¹èµè€…
  eventId   String   // è¢«ç‚¹èµçš„æ´»åŠ¨
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@unique([userId, eventId]) // é˜²æ­¢é‡å¤ç‚¹èµ
  @@map("event_like")
}

// Website Like System - ç½‘ç«™ç‚¹èµç³»ç»Ÿ
model Website {
  id          String        @id @default(cuid())
  name        String        // ç½‘ç«™åç§°
  url         String        @unique // ç½‘ç«™URL
  description String?       // ç½‘ç«™æè¿°
  category    String?       // ç½‘ç«™åˆ†ç±»
  tags        String[]      @default([]) // æ ‡ç­¾
  favicon     String?       // ç½‘ç«™å›¾æ ‡URL
  screenshot  String?       // ç½‘ç«™æˆªå›¾URL
  
  // æäº¤ä¿¡æ¯
  submittedBy String        // æäº¤è€…ID
  organizationId String?    // æ‰€å±ç»„ç»‡IDï¼ˆå¯é€‰ï¼‰
  isApproved  Boolean       @default(false) // æ˜¯å¦é€šè¿‡å®¡æ ¸
  approvedBy  String?       // å®¡æ ¸è€…ID
  approvedAt  DateTime?     // å®¡æ ¸æ—¶é—´
  
  // ç»Ÿè®¡æ•°æ®
  likeCount   Int           @default(0) // ç‚¹èµæ•°
  viewCount   Int           @default(0) // æŸ¥çœ‹æ•°
  clickCount  Int           @default(0) // ç‚¹å‡»æ•°
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  // Relations
  submitter   User          @relation(fields: [submittedBy], references: [id])
  organization Organization? @relation(fields: [organizationId], references: [id])
  approver    User?         @relation("ApprovedWebsites", fields: [approvedBy], references: [id])
  likes       WebsiteLike[]
  
  @@map("website")
}

model WebsiteLike {
  id        String   @id @default(cuid())
  userId    String   // ç‚¹èµè€…
  websiteId String   // è¢«ç‚¹èµçš„ç½‘ç«™
  createdAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  website   Website  @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  
  @@unique([userId, websiteId]) // é˜²æ­¢é‡å¤ç‚¹èµ
  @@map("website_like")
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  WITHDRAWN
}

enum OrganizationInvitationRequestStatus {
  PENDING
  APPLICATION_SUBMITTED
  APPROVED
  REJECTED
}

// Notification System Models
model Notification {
  id          String   @id @default(cuid())
  userId      String   // æ¥æ”¶é€šçŸ¥çš„ç”¨æˆ·ID
  type        NotificationType
  title       String   // é€šçŸ¥æ ‡é¢˜
  content     String   // é€šçŸ¥å†…å®¹
  metadata    Json?    // æ‰©å±•æ•°æ®ï¼ˆå¦‚å…³è”çš„ä½œå“IDã€ç»„ç»‡IDç­‰ï¼‰
  read        Boolean  @default(false)
  readAt      DateTime?
  actionUrl   String?  // å¯é€‰çš„æ“ä½œé“¾æ¥
  priority    NotificationPriority @default(NORMAL)
  
  // å…³è”æ•°æ®
  relatedUserId String? // è§¦å‘é€šçŸ¥çš„ç”¨æˆ·ID
  relatedUser   User?   @relation("RelatedNotifications", fields: [relatedUserId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Relations
  emailNotifications EmailNotificationQueue[]

  @@index([userId, createdAt])
  @@index([userId, read])
  @@index([userId, priority, createdAt]) // ä¼˜å…ˆçº§é€šçŸ¥æŸ¥è¯¢ä¼˜åŒ–
  @@map("notification")
}

model NotificationPreference {
  id                    String  @id @default(cuid())
  userId                String  @unique
  
  // ä½œå“é€šçŸ¥åå¥½
  projectCommentEmail   Boolean @default(true)
  projectCommentPush    Boolean @default(true)
  projectLikeEmail      Boolean @default(false)
  projectLikePush       Boolean @default(true)
  
  // ç»„ç»‡é€šçŸ¥åå¥½
  organizationEmail     Boolean @default(true)
  organizationPush      Boolean @default(true)
  
  // æ´»åŠ¨é€šçŸ¥åå¥½
  eventEmail            Boolean @default(true)
  eventPush             Boolean @default(true)
  eventReminderEmail    Boolean @default(true)
  
  // ç³»ç»Ÿé€šçŸ¥åå¥½
  systemEmail           Boolean @default(true)
  systemPush            Boolean @default(true)
  
  // ç¤¾äº¤é€šçŸ¥åå¥½
  socialEmail           Boolean @default(false)
  socialPush            Boolean @default(true)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notification_preference")
}

model EmailNotificationQueue {
  id            String   @id @default(cuid())
  userId        String
  notificationId String?
  emailType     String   // é‚®ä»¶æ¨¡æ¿ç±»å‹
  emailData     Json     // é‚®ä»¶æ•°æ®
  priority      NotificationPriority @default(NORMAL)
  status        EmailStatus @default(PENDING)
  scheduledAt   DateTime @default(now())
  sentAt        DateTime?
  errorMessage  String?
  retryCount    Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  notification  Notification? @relation(fields: [notificationId], references: [id])

  @@index([status, scheduledAt])
  @@index([userId, status]) // ç”¨æˆ·é‚®ä»¶é€šçŸ¥çŠ¶æ€æŸ¥è¯¢ä¼˜åŒ–
  @@map("email_notification_queue")
}

enum NotificationType {
  // ä½œå“ç›¸å…³
  PROJECT_COMMENT
  PROJECT_LIKE
  PROJECT_STATUS_UPDATE
  PROJECT_COLLABORATION_INVITE
  PROJECT_VIEW_MILESTONE
  
  // ç»„ç»‡ç›¸å…³
  ORGANIZATION_MEMBER_APPLICATION
  ORGANIZATION_APPLICATION_RESULT
  ORGANIZATION_MEMBER_INVITED
  ORGANIZATION_ROLE_CHANGE
  ORGANIZATION_ANNOUNCEMENT
  ORGANIZATION_MEMBER_REMOVED
  ORGANIZATION_MEMBER_JOINED
  
  // æ´»åŠ¨ç›¸å…³
  EVENT_REGISTRATION_RESULT
  EVENT_TIME_CHANGE
  EVENT_CANCELLED
  EVENT_REMINDER
  EVENT_CHECKIN_OPEN
  EVENT_NEW_REGISTRATION
  EVENT_CAPACITY_WARNING
  EVENT_PHOTO_UPLOADED
  
  // ç³»ç»Ÿé€šçŸ¥
  ACCOUNT_SECURITY
  ACCOUNT_BANNED
  SYSTEM_ANNOUNCEMENT
  ACHIEVEMENT_UNLOCKED
  DAILY_REWARD
  
  // ç¤¾äº¤é€šçŸ¥
  USER_BOOKMARKED
  USER_FOLLOWED
  USER_LIKED
  PRIVATE_MESSAGE
  PROFILE_VIEW_MILESTONE
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
  RETRY
  CANCELLED
}

enum EventAdminRole {
  ADMIN        // Regular admin - can edit event and manage registrations
  SUPER_ADMIN  // Super admin - can do everything including managing other admins
}

enum EventAdminStatus {
  PENDING      // Invitation sent, waiting for acceptance
  ACCEPTED     // Invitation accepted, admin is active
  REJECTED     // Invitation was rejected
  REMOVED      // Admin was removed by another admin
}

// Volunteer Role System Models

model VolunteerRole {
  id             String   @id @default(cuid())
  name           String   @unique // å¿—æ„¿è€…è§’è‰²åç§° (å¦‚ï¼šä¸»æŒäºº)
  description    String   // ä¸€å¥è¯èŒè´£æè¿°
  detailDescription String? // è¯¦ç»†æè¿° (æ”¯æŒMarkdown)
  iconUrl        String?  // å›¾æ ‡URL
  cpPoints       Int      @default(0) // æ¯æ¬¡æ‹…ä»»å¯è·å¾—çš„ç§¯åˆ†
  isActive       Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  sortOrder      Int      @default(0) // æ’åº
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  eventVolunteerRoles EventVolunteerRole[]
  templateVolunteerRoles EventTemplateVolunteerRole[]
  
  @@map("volunteer_role")
}

model EventVolunteerRole {
  id              String    @id @default(cuid())
  eventId         String
  volunteerRoleId String
  recruitCount    Int       @default(1) // æ‹›å‹Ÿæ•°é‡
  description     String?   // æ­¤æ´»åŠ¨ä¸­è¯¥è§’è‰²çš„ç‰¹æ®Šè¯´æ˜
  requireApproval Boolean   @default(true) // æ˜¯å¦éœ€è¦å®¡æ‰¹
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Relations
  event           Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  volunteerRole   VolunteerRole @relation(fields: [volunteerRoleId], references: [id], onDelete: Cascade)
  registrations   EventVolunteerRegistration[]
  
  @@unique([eventId, volunteerRoleId]) // åŒä¸€æ´»åŠ¨ä¸èƒ½é‡å¤æ·»åŠ åŒä¸€å¿—æ„¿è€…è§’è‰²
  @@map("event_volunteer_role")
}

model EventVolunteerRegistration {
  id                     String               @id @default(cuid())
  eventId                String
  userId                 String
  eventVolunteerRoleId   String
  status                 VolunteerStatus      @default(APPLIED)
  
  // Registration information
  appliedAt              DateTime             @default(now())
  approvedAt             DateTime?
  approvedBy             String?
  rejectedAt             DateTime?
  rejectedBy             String?
  note                   String?              // ç”³è¯·å¤‡æ³¨
  
  // Check-in and completion
  checkedIn              Boolean              @default(false)
  checkedInAt            DateTime?
  completed              Boolean              @default(false)
  completedAt            DateTime?
  cpAwarded              Boolean              @default(false) // æ˜¯å¦å·²å‘æ”¾ç§¯åˆ†
  
  // Relations
  event                  Event                @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user                   User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventVolunteerRole     EventVolunteerRole   @relation(fields: [eventVolunteerRoleId], references: [id], onDelete: Cascade)
  approver               User?                @relation("ApprovedVolunteers", fields: [approvedBy], references: [id])
  rejecter               User?                @relation("RejectedVolunteers", fields: [rejectedBy], references: [id])
  
  @@unique([eventId, userId, eventVolunteerRoleId]) // åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç”³è¯·åŒä¸€æ´»åŠ¨çš„åŒä¸€å¿—æ„¿è€…è§’è‰²
  @@map("event_volunteer_registration")
}

enum VolunteerStatus {
  APPLIED    // å·²ç”³è¯·
  APPROVED   // å·²é€šè¿‡
  REJECTED   // å·²æ‹’ç»
  CANCELLED  // å·²å–æ¶ˆ
}

// ===== æ´»åŠ¨æ¨¡æ¿ç³»ç»Ÿ =====

// æ´»åŠ¨æ¨¡æ¿è¡¨
model EventTemplate {
  id              String              @id @default(cuid())
  name            String              // æ¨¡æ¿åç§°
  type            EventTemplateType   // æ¨¡æ¿ç±»å‹
  description     String              // æ¨¡æ¿æè¿°
  
  // åŸºæœ¬æ´»åŠ¨ä¿¡æ¯æ¨¡æ¿
  title           String              // é»˜è®¤æ´»åŠ¨æ ‡é¢˜
  defaultDescription String           // é»˜è®¤æ´»åŠ¨æè¿°  
  shortDescription  String?           // é»˜è®¤æ´»åŠ¨ç®€ä»‹
  duration        Int?                // å»ºè®®æ—¶é•¿(åˆ†é’Ÿ)
  maxAttendees    Int?                // å»ºè®®æœ€å¤§å‚ä¸äººæ•°
  requireApproval Boolean             @default(false) // æ˜¯å¦éœ€è¦å®¡æ ¸
  
  // æ¨¡æ¿ç±»å‹å’Œæƒé™æ§åˆ¶
  templateType    EventTemplateCategory @default(SYSTEM) // æ¨¡æ¿åˆ†ç±»
  isSystemTemplate Boolean            @default(false) // æ˜¯å¦ä¸ºç³»ç»Ÿæ¨¡æ¿ï¼ˆå‘åå…¼å®¹ï¼‰
  isFeatured      Boolean             @default(false) // æ˜¯å¦ä¸ºç²¾é€‰æ¨¡æ¿
  isPublic        Boolean             @default(true)  // ä¸ªäººæ¨¡æ¿æ˜¯å¦å…¬å¼€
  isActive        Boolean             @default(true)  // æ˜¯å¦å¯ç”¨
  
  // åˆ›å»ºå’Œå…³è”ä¿¡æ¯
  createdBy       String?             // åˆ›å»ºè€…ID
  organizationId  String?             // æ‰€å±ç»„ç»‡ID
  originalEventId String?             // åŸºäºå“ªä¸ªæ´»åŠ¨åˆ›å»ºçš„æ¨¡æ¿
  
  // ä½¿ç”¨ç»Ÿè®¡
  usageCount      Int                 @default(0)     // ä½¿ç”¨æ¬¡æ•°
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  creator         User?               @relation(fields: [createdBy], references: [id])
  organization    Organization?       @relation(fields: [organizationId], references: [id])
  originalEvent   Event?              @relation("EventToTemplate", fields: [originalEventId], references: [id])
  events          Event[]             // ä½¿ç”¨æ­¤æ¨¡æ¿çš„æ´»åŠ¨
  ticketTypes     EventTemplateTicketType[]
  volunteerRoles  EventTemplateVolunteerRole[]
  questions       EventTemplateQuestion[]
  schedules       EventTemplateSchedule[]
  
  @@index([templateType, isFeatured])
  @@index([createdBy])
  @@index([isActive])
  @@map("event_template")
}

// æ¨¡æ¿ç¥¨ç§é…ç½®
model EventTemplateTicketType {
  id              String          @id @default(cuid())
  templateId      String
  name            String          // ç¥¨ç§åç§°
  description     String?         // ç¥¨ç§è¯´æ˜
  price           Float?          // ä»·æ ¼
  maxQuantity     Int?            // æœ€å¤§æ•°é‡
  isDefault       Boolean         @default(false) // æ˜¯å¦ä¸ºé»˜è®¤ç¥¨ç§
  sortOrder       Int             @default(0)
  requirements    String?         // ç¥¨ç§è¦æ±‚æè¿°
  
  template        EventTemplate   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@map("event_template_ticket_type")
}

// æ¨¡æ¿å¿—æ„¿è€…è§’è‰²é…ç½®  
model EventTemplateVolunteerRole {
  id              String          @id @default(cuid())
  templateId      String
  volunteerRoleId String
  recruitCount    Int             @default(1)
  description     String?
  requireApproval Boolean         @default(true)
  cpReward        Int             @default(0) // CPå¥–åŠ±
  
  template        EventTemplate   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  volunteerRole   VolunteerRole   @relation(fields: [volunteerRoleId], references: [id])
  
  @@map("event_template_volunteer_role")
}

// æ¨¡æ¿é¢„è®¾é—®é¢˜
model EventTemplateQuestion {
  id              String          @id @default(cuid())
  templateId      String
  question        String
  type            QuestionType
  options         String[]        @default([])
  required        Boolean         @default(false)
  targetRole      String?         // é’ˆå¯¹ç‰¹å®šè§’è‰²çš„é—®é¢˜ (speaker/audience/all)
  order           Int             @default(0)
  
  template        EventTemplate   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@map("event_template_question")  
}

// æ¨¡æ¿æµç¨‹å®‰æ’
model EventTemplateSchedule {
  id              String          @id @default(cuid())
  templateId      String
  title           String          // ç¯èŠ‚æ ‡é¢˜
  description     String?         // ç¯èŠ‚æè¿°
  startMinute     Int             // å¼€å§‹æ—¶é—´(ç›¸å¯¹åˆ†é’Ÿ)
  duration        Int             // æŒç»­æ—¶é—´(åˆ†é’Ÿ)
  type            ScheduleType    // ç¯èŠ‚ç±»å‹
  order           Int             @default(0)
  
  template        EventTemplate   @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@map("event_template_schedule")
}

enum EventTemplateType {
  MEETUP             // Regular Event/Meetup
  HACKATHON_LEARNING  // è¿·ä½ é»‘å®¢æ¾
  BUILDING_PUBLIC    // Building Publicæ‰“å¡
  CUSTOM             // è‡ªå®šä¹‰æ¨¡æ¿
}

enum EventTemplateCategory {
  SYSTEM             // ç³»ç»Ÿæ¨¡æ¿
  PERSONAL           // ä¸ªäººæ¨¡æ¿
}

enum ScheduleType {
  CHECK_IN           // ç­¾åˆ°
  INTRODUCTION       // ä»‹ç»
  LEARNING           // å­¦ä¹ 
  DEVELOPMENT        // å¼€å‘
  DEMO               // æ¼”ç¤º
  NETWORKING         // ç¤¾äº¤
  AWARD              // é¢å¥–
  BREAK              // ä¼‘æ¯
}

// ===== ä½œå“æäº¤ç³»ç»Ÿ =====

// æ´»åŠ¨ä½œå“æäº¤è¡¨
model EventProjectSubmission {
  id              String              @id @default(cuid())
  eventId         String
  projectId       String
  userId          String              // æäº¤è€…
  submissionType  SubmissionType      // æäº¤ç±»å‹
  
  // æäº¤ä¿¡æ¯
  title           String              // æäº¤æ ‡é¢˜(å¯ä¸ä½œå“åç§°ä¸åŒ)
  description     String              // æœ¬æ¬¡æäº¤çš„æè¿°
  demoUrl         String?             // æ¼”ç¤ºé“¾æ¥
  sourceCode      String?             // æºç é“¾æ¥
  presentationUrl String?             // æ¼”ç¤ºæ–‡æ¡£é“¾æ¥
  
  // çŠ¶æ€ç®¡ç†
  status          SubmissionStatus    @default(SUBMITTED)
  submittedAt     DateTime            @default(now())
  reviewedAt      DateTime?
  reviewedBy      String?
  reviewNote      String?
  
  // è¯„åˆ†ä¿¡æ¯
  judgeScore      Float?              // è¯„å§”è¯„åˆ†
  audienceScore   Float?              // è§‚ä¼—è¯„åˆ†
  finalScore      Float?              // æœ€ç»ˆå¾—åˆ†
  
  // ä½œå“å¿«ç…§(æäº¤æ—¶çš„ä½œå“çŠ¶æ€)
  projectSnapshot Json                // ä½œå“ä¿¡æ¯å¿«ç…§
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  project         Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewer        User?               @relation("ReviewedSubmissions", fields: [reviewedBy], references: [id])
  awards          ProjectAward[]      // è·å¾—çš„å¥–é¡¹
  
  @@unique([eventId, projectId]) // åŒä¸€æ´»åŠ¨ä¸­åŒä¸€ä½œå“åªèƒ½æäº¤ä¸€æ¬¡
  @@map("event_project_submission")
}

enum SubmissionType {
  HACKATHON_PROJECT   // é»‘å®¢æ¾ä½œå“
  DEMO_PROJECT        // Demoæ¼”ç¤ºä½œå“  
  BUILDING_PROJECT    // Buildingä½œå“
}

enum SubmissionStatus {
  SUBMITTED           // å·²æäº¤
  UNDER_REVIEW        // å®¡æ ¸ä¸­
  APPROVED            // å·²é€šè¿‡
  REJECTED            // å·²æ‹’ç»
  AWARDED             // å·²è·å¥–
}

// ===== ç”µå­å¥–çŠ¶å’Œå¥–é¡¹ç®¡ç†ç³»ç»Ÿ =====

// å¥–é¡¹è¡¨
model Award {
  id              String          @id @default(cuid())
  name            String          @unique // å¥–é¡¹åç§°
  description     String          // å¥–é¡¹æè¿°
  category        AwardCategory   // å¥–é¡¹ç±»åˆ«
  level           AwardLevel      // å¥–é¡¹çº§åˆ«
  
  // è§†è§‰è®¾è®¡
  iconUrl         String?         // å¥–é¡¹å›¾æ ‡
  badgeUrl        String?         // å¾½ç« å›¾ç‰‡
  certificateTemplate String?     // è¯ä¹¦æ¨¡æ¿
  color           String?         // ä¸»é¢˜è‰²å½©
  
  // å¥–é¡¹è®¾ç½®
  isActive        Boolean         @default(true)
  cpReward        Int             @default(0) // CPå¥–åŠ±
  sortOrder       Int             @default(0)
  
  // å…ƒä¿¡æ¯
  createdBy       String?         // åˆ›å»ºè€…
  organizationId  String?         // æ‰€å±ç»„ç»‡
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  // Relations
  creator         User?           @relation(fields: [createdBy], references: [id])
  organization    Organization?   @relation(fields: [organizationId], references: [id])
  projectAwards   ProjectAward[]  // ä½œå“è·å¥–è®°å½•
  
  @@map("award")
}

// ä½œå“è·å¥–è®°å½•è¡¨
model ProjectAward {
  id              String              @id @default(cuid())
  projectId       String
  awardId         String
  eventId         String?             // è·å¥–æ´»åŠ¨
  submissionId    String?             // å…³è”çš„æäº¤è®°å½•
  
  // è·å¥–ä¿¡æ¯
  awardedAt       DateTime            @default(now())
  awardedBy       String              // é¢å‘è€…
  reason          String?             // è·å¥–ç†ç”±
  score           Float?              // è·å¥–åˆ†æ•°
  
  // è¯ä¹¦ä¿¡æ¯
  certificateUrl  String?             // ç”µå­è¯ä¹¦URL
  certificateGenerated Boolean        @default(false)
  
  // Relations
  project         Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  award           Award               @relation(fields: [awardId], references: [id], onDelete: Cascade)
  event           Event?              @relation(fields: [eventId], references: [id])
  submission      EventProjectSubmission? @relation(fields: [submissionId], references: [id])
  awarder         User                @relation(fields: [awardedBy], references: [id])
  
  @@unique([projectId, awardId, eventId]) // åŒä¸€ä½œå“åœ¨åŒä¸€æ´»åŠ¨ä¸­ä¸èƒ½é‡å¤è·å¾—åŒä¸€å¥–é¡¹
  @@map("project_award")
}

enum AwardCategory {
  GENERAL         // é€šç”¨å¥–é¡¹
  TECHNICAL       // æŠ€æœ¯å¥–é¡¹  
  CREATIVE        // åˆ›æ„å¥–é¡¹
  COMMERCIAL      // å•†ä¸šå¥–é¡¹
  SOCIAL          // ç¤¾ä¼šå½±å“å¥–é¡¹
  SPECIAL         // ç‰¹æ®Šå¥–é¡¹
}

enum AwardLevel {
  FIRST           // ä¸€ç­‰å¥–
  SECOND          // äºŒç­‰å¥–
  THIRD           // ä¸‰ç­‰å¥–
  EXCELLENCE      // ä¼˜ç§€å¥–
  PARTICIPATION   // å‚ä¸å¥–
  SPECIAL         // ç‰¹æ®Šå¥–
}

// ===== Building Publicæ‰“å¡ç³»ç»Ÿ =====

// Building Publicæ´»åŠ¨æ‰©å±•é…ç½®
model BuildingActivityConfig {
  id              String          @id @default(cuid())
  eventId         String          @unique
  
  // æ‰“å¡é…ç½®
  duration        Int             @default(21)        // æ´»åŠ¨å¤©æ•°
  requiredCheckIns Int            @default(7)         // è¦æ±‚æ‰“å¡æ¬¡æ•°
  depositAmount   Float           @default(100)       // æŠ¼é‡‘é‡‘é¢
  refundRate      Float           @default(0.8)       // æœªå®Œæˆé€€æ¬¾æ¯”ä¾‹
  
  // æ”¯ä»˜é…ç½®
  paymentType     String          @default("NONE")    // æ”¯ä»˜ç±»å‹ï¼šNONE, CUSTOM, STRIPE, ALIPAY ç­‰
  paymentUrl      String?         // è‡ªå®šä¹‰æ”¯ä»˜é“¾æ¥
  paymentQRCode   String?         // æ”¯ä»˜äºŒç»´ç å›¾ç‰‡URL
  paymentNote     String?         // æ”¯ä»˜è¯´æ˜æ–‡å­—
  
  // å†…å®¹è®¾ç½®
  isPublic        Boolean         @default(true)      // é»˜è®¤æ˜¯å¦å…¬å¼€
  allowAnonymous  Boolean         @default(false)     // æ˜¯å¦å…è®¸åŒ¿åæ‰“å¡
  
  // è¯„é€‰è®¾ç½®
  enableVoting    Boolean         @default(true)      // æ˜¯å¦å¯ç”¨æŠ•ç¥¨
  votingEndTime   DateTime?                           // æŠ•ç¥¨æˆªæ­¢æ—¶é—´
  
  event           Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@map("building_activity_config")
}

// Building PublicæŠ¥åè®°å½•æ‰©å±•
model BuildingRegistration {
  id              String              @id @default(cuid())
  eventId         String
  userId          String
  projectId       String              // å…³è”ä½œå“
  
  // æŠ¥åä¿¡æ¯
  plan21Days      String              // 21å¤©å¼€å‘è®¡åˆ’å’Œç›®æ ‡åˆå¹¶
  visibilityLevel VisibilityLevel     @default(PUBLIC) // å¯è§æ€§çº§åˆ«
  
  // æŠ¼é‡‘ä¿¡æ¯
  depositPaid     Boolean             @default(false)
  depositAmount   Float               
  depositStatus   DepositStatus       @default(PENDING)
  
  // ç»Ÿè®¡æ•°æ®
  checkInCount    Int                 @default(0)    // å·²æ‰“å¡æ¬¡æ•°
  likeCount       Int                 @default(0)    // è·å¾—ç‚¹èµæ•°
  commentCount    Int                 @default(0)    // è·å¾—è¯„è®ºæ•°
  
  // å®ŒæˆçŠ¶æ€
  isCompleted     Boolean             @default(false)
  completedAt     DateTime?
  finalScore      Float?              // æœ€ç»ˆè¯„åˆ†
  
  registeredAt    DateTime            @default(now())
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  project         Project             @relation(fields: [projectId], references: [id])
  checkIns        CheckInRecord[]
  depositTrans    DepositTransaction[]
  
  @@unique([eventId, userId])
  @@map("building_registration")
}

// æ‰“å¡è®°å½•è¡¨
model CheckInRecord {
  id              String              @id @default(cuid())
  registrationId  String
  eventId         String
  userId          String
  day             Int                 // ç¬¬å‡ å¤©æ‰“å¡
  
  // æ‰“å¡å†…å®¹
  title           String              // æ‰“å¡æ ‡é¢˜
  content         String              // æ‰“å¡å†…å®¹(è¿›åº¦æè¿°)
  nextPlan        String?             // ä¸‹ä¸€æ­¥è®¡åˆ’
  imageUrls       String[]            @default([]) // æˆªå›¾
  demoUrl         String?             // æ¼”ç¤ºé“¾æ¥
  
  // çŠ¶æ€ä¿¡æ¯
  isApproved      Boolean             @default(true)
  isPublic        Boolean             @default(true)
  
  // äº’åŠ¨æ•°æ®
  likeCount       Int                 @default(0)
  commentCount    Int                 @default(0)
  
  checkedInAt     DateTime            @default(now())
  
  // Relations
  registration    BuildingRegistration @relation(fields: [registrationId], references: [id], onDelete: Cascade)
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes           CheckInLike[]
  comments        CheckInComment[]
  
  @@map("check_in_record")
}

// æ‰“å¡ç‚¹èµè¡¨
model CheckInLike {
  id              String          @id @default(cuid())
  checkInId       String
  userId          String
  likedAt         DateTime        @default(now())
  
  checkIn         CheckInRecord   @relation(fields: [checkInId], references: [id], onDelete: Cascade)
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([checkInId, userId])
  @@map("check_in_like")
}

// æ‰“å¡è¯„è®ºè¡¨
model CheckInComment {
  id              String          @id @default(cuid())
  checkInId       String
  userId          String
  content         String
  commentedAt     DateTime        @default(now())
  
  checkIn         CheckInRecord   @relation(fields: [checkInId], references: [id], onDelete: Cascade)
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("check_in_comment")
}

// æŠ¼é‡‘äº¤æ˜“è®°å½•è¡¨
model DepositTransaction {
  id              String              @id @default(cuid())
  registrationId  String
  userId          String
  type            TransactionType     // äº¤æ˜“ç±»å‹
  amount          Float               // é‡‘é¢
  status          TransactionStatus   // çŠ¶æ€
  
  // æ”¯ä»˜ä¿¡æ¯
  paymentId       String?             // ç¬¬ä¸‰æ–¹æ”¯ä»˜ID
  paymentMethod   String?             // æ”¯ä»˜æ–¹å¼
  paidAt          DateTime?           // æ”¯ä»˜æ—¶é—´
  
  // é€€æ¬¾ä¿¡æ¯
  refundReason    String?             // é€€æ¬¾åŸå› 
  refundRate      Float?              // é€€æ¬¾æ¯”ä¾‹
  refundedAt      DateTime?           // é€€æ¬¾æ—¶é—´
  
  createdAt       DateTime            @default(now())
  
  // Relations
  registration    BuildingRegistration @relation(fields: [registrationId], references: [id], onDelete: Cascade)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("deposit_transaction")
}

enum DepositStatus {
  PENDING         // å¾…æ”¯ä»˜
  PAID            // å·²æ”¯ä»˜
  REFUNDED        // å·²é€€æ¬¾
  FORFEITED       // å·²æ²¡æ”¶
}

enum VisibilityLevel {
  PUBLIC              // æ‰€æœ‰äººå¯è§
  PARTICIPANTS_ONLY   // ä»…æŠ¥åè€…å¯è§
}

enum TransactionType {
  DEPOSIT         // æŠ¼é‡‘æ”¯ä»˜
  REFUND          // é€€æ¬¾
  FORFEIT         // æ²¡æ”¶
}

enum TransactionStatus {
  PENDING         // å¾…å¤„ç†
  PROCESSING      // å¤„ç†ä¸­
  COMPLETED       // å·²å®Œæˆ
  FAILED          // å¤±è´¥
  CANCELLED       // å·²å–æ¶ˆ
}

// ===== AIæ¨èç³»ç»Ÿ =====

model EventAIRecommendation {
  id              String              @id @default(cuid())
  eventId         String
  type            RecommendationType  // UNIFIED(ç»Ÿä¸€æ¨è) or PERSONAL(ä¸ªæ€§åŒ–æ¨è)
  userId          String?             // nullè¡¨ç¤ºç»Ÿä¸€æ¨èï¼Œæœ‰å€¼è¡¨ç¤ºä¸ªæ€§åŒ–æ¨è
  recommendations Json                // æ¨èç»“æœJSON
  metadata        Json?               // å…ƒæ•°æ®ï¼ˆå¦‚ç”Ÿæˆæ—¶çš„å‚ä¸äººæ•°ç­‰ï¼‰
  createdAt       DateTime            @default(now())
  expiresAt       DateTime            // è¿‡æœŸæ—¶é—´
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user            User?               @relation(fields: [userId], references: [id], onDelete: Cascade)
  feedbacks       RecommendationFeedback[]
  
  @@unique([eventId, type, userId])
  @@index([eventId, type])
  @@index([userId])
  @@map("event_ai_recommendation")
}

model RecommendationFeedback {
  id                String              @id @default(cuid())
  recommendationId  String
  userId            String
  helpful           Boolean
  comment           String?
  createdAt         DateTime            @default(now())
  
  // Relations
  recommendation    EventAIRecommendation @relation(fields: [recommendationId], references: [id], onDelete: Cascade)
  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([recommendationId, userId])
  @@map("recommendation_feedback")
}

enum RecommendationType {
  UNIFIED         // ç»Ÿä¸€æ¨èï¼ˆæŠ¥åå‰ï¼‰
  PERSONAL        // ä¸ªæ€§åŒ–æ¨èï¼ˆæŠ¥ååï¼‰
}

// ===== ç­‰çº§ç³»ç»Ÿ =====

// åŸºç¡€æˆå‘˜ç­‰çº§æšä¸¾
enum MembershipLevel {
  VISITOR         // æ¸¸å®¢
  MEMBER          // æ­£å¼æˆå‘˜
}

// åˆ›é€ è€…è½¨é“ç­‰çº§æšä¸¾
enum CreatorLevel {
  C1              // æ¢ç´¢è€…
  C2              // åˆ›é€ è€…
  C3              // å¢é•¿è€…
  C4              // é¢†è·‘è€…
  C5              // å¼•é¢†è€…
}

// è´¡çŒ®è€…è½¨é“ç­‰çº§æšä¸¾
enum MentorLevel {
  M1              // åˆ†äº«è€…
  M2              // è®²å¸ˆ
  M3              // å¯¼å¸ˆ
  M4              // ä¸“å®¶å¯¼å¸ˆ
  M5              // è£èª‰å¯¼å¸ˆ
}

enum ContributorLevel {
  O1              // å¿—æ„¿è€…
  O2              // å…±åˆ›è€…
  O3              // ç»„ç»‡è€…
  O4              // æ ¸å¿ƒç»„ç»‡è€…
  O5              // è£èª‰è´¡çŒ®è€…
}


// ç­‰çº§ç”³è¯·ç±»å‹æšä¸¾
enum LevelType {
  MEMBERSHIP      // åŸºç¡€æˆå‘˜ç­‰çº§
  CREATOR         // åˆ›é€ è€…è½¨é“
  MENTOR          // å¯¼å¸ˆè½¨é“
  CONTRIBUTOR     // è´¡çŒ®è€…è½¨é“
}

// ç­‰çº§ç”³è¯·æ“ä½œç±»å‹æšä¸¾
enum LevelApplicationAction {
  UPGRADE         // å‡çº§
  DOWNGRADE       // é™çº§
}

// ç­‰çº§ç”³è¯·çŠ¶æ€æšä¸¾
enum LevelApplicationStatus {
  PENDING         // å¾…å®¡æ ¸
  APPROVED        // å·²é€šè¿‡
  REJECTED        // å·²æ‹’ç»
  CANCELLED       // å·²å–æ¶ˆ
}

// ç­‰çº§ç”³è¯·è¡¨
model LevelApplication {
  id              String                  @id @default(cuid())
  userId          String                  // ç”³è¯·äººID
  levelType       LevelType               // ç”³è¯·çš„ç­‰çº§ç±»å‹
  action          LevelApplicationAction  // ç”³è¯·æ“ä½œï¼ˆå‡çº§/é™çº§ï¼‰
  targetLevel     String                  // ç›®æ ‡ç­‰çº§å­—ç¬¦ä¸² (å¦‚ "MEMBER", "C2", "T3")
  currentLevel    String?                 // å½“å‰ç­‰çº§å­—ç¬¦ä¸²
  reason          String                  // ç”³è¯·ç†ç”±
  evidence        String?                 // è¯æ˜ææ–™/é“¾æ¥
  status          LevelApplicationStatus  @default(PENDING)
  
  // å®¡æ ¸ä¿¡æ¯
  reviewedBy      String?                 // å®¡æ ¸äººID
  reviewedAt      DateTime?               // å®¡æ ¸æ—¶é—´
  reviewNote      String?                 // å®¡æ ¸å¤‡æ³¨
  
  // æ˜¯å¦ä¸ºç®¡ç†å‘˜ä»£ä¸ºç”³è¯·
  submittedByAdmin Boolean                @default(false)
  
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  
  // Relations
  user            User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewer        User?                   @relation("ReviewedLevelApplications", fields: [reviewedBy], references: [id])
  
  @@index([userId, status])
  @@index([status, createdAt])
  @@map("level_application")
}

// Customer Service Configuration
model CustomerServiceConfig {
  id          String   @id @default(cuid())
  qrCodeUrl   String?  // ç¤¾ç¾¤äºŒç»´ç URL
  qrCodeAlt   String?  // äºŒç»´ç æè¿°æ–‡æœ¬  
  isActive    Boolean  @default(true)
  updatedBy   String   // æ›´æ–°äººå‘˜ID
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
  
  // å…³è”ç”¨æˆ·
  updatedByUser User   @relation(fields: [updatedBy], references: [id])
  
  @@map("customer_service_config")
}

// ===== Event Communication System =====

// æ´»åŠ¨é€šä¿¡è®°å½•è¡¨
model EventCommunication {
  id              String              @id @default(cuid())
  eventId         String              // æ´»åŠ¨ID
  sentBy          String              // å‘é€è€…ID
  type            CommunicationType   // é€šä¿¡ç±»å‹
  subject         String              // ä¸»é¢˜
  content         String              // å†…å®¹
  
  // å‘é€ç»Ÿè®¡
  totalRecipients Int                 @default(0) // æ€»æ”¶ä»¶äººæ•°
  sentCount       Int                 @default(0) // å·²å‘é€æ•°é‡
  deliveredCount  Int                 @default(0) // æŠ•é€’æˆåŠŸæ•°é‡
  failedCount     Int                 @default(0) // å¤±è´¥æ•°é‡
  
  // å‘é€çŠ¶æ€
  status          CommunicationStatus @default(PENDING)
  scheduledAt     DateTime?           // è®¡åˆ’å‘é€æ—¶é—´
  sentAt          DateTime?           // å®é™…å‘é€æ—¶é—´
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  // Relations
  event           Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  sender          User                @relation("SentCommunications", fields: [sentBy], references: [id])
  records         EventCommunicationRecord[] // å…·ä½“å‘é€è®°å½•
  
  @@index([eventId, createdAt])
  @@index([sentBy])
  @@map("event_communication")
}

// æ´»åŠ¨é€šä¿¡å‘é€è®°å½•è¡¨ï¼ˆå…·ä½“åˆ°æ¯ä¸ªæ¥æ”¶è€…ï¼‰
model EventCommunicationRecord {
  id                  String               @id @default(cuid())
  communicationId     String               // é€šä¿¡è®°å½•ID
  eventId             String               // æ´»åŠ¨ID
  recipientId         String               // æ”¶ä»¶äººç”¨æˆ·ID
  recipientEmail      String?              // æ”¶ä»¶äººé‚®ç®±
  recipientPhone      String?              // æ”¶ä»¶äººæ‰‹æœºå·
  
  // å‘é€çŠ¶æ€
  status              CommunicationRecordStatus @default(PENDING)
  sentAt              DateTime?           // å‘é€æ—¶é—´
  deliveredAt         DateTime?           // æŠ•é€’æ—¶é—´
  readAt              DateTime?           // é˜…è¯»æ—¶é—´ï¼ˆé‚®ä»¶æ‰“å¼€æˆ–çŸ­ä¿¡æŸ¥çœ‹ï¼‰
  errorMessage        String?             // é”™è¯¯ä¿¡æ¯
  retryCount          Int                 @default(0) // é‡è¯•æ¬¡æ•°
  
  // ç¬¬ä¸‰æ–¹æœåŠ¡ä¿¡æ¯
  externalMessageId   String?             // ç¬¬ä¸‰æ–¹æœåŠ¡æ¶ˆæ¯ID
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  
  // Relations
  communication       EventCommunication  @relation(fields: [communicationId], references: [id], onDelete: Cascade)
  event               Event               @relation(fields: [eventId], references: [id], onDelete: Cascade)
  recipient           User                @relation(fields: [recipientId], references: [id], onDelete: Cascade)
  
  @@unique([communicationId, recipientId]) // åŒä¸€é€šä¿¡è®°å½•ä¸èƒ½é‡å¤å‘é€ç»™åŒä¸€ç”¨æˆ·
  @@index([eventId, status])
  @@index([recipientId])
  @@map("event_communication_record")
}

enum CommunicationType {
  EMAIL           // é‚®ä»¶
  SMS             // çŸ­ä¿¡
}

enum CommunicationStatus {
  PENDING         // å¾…å‘é€
  SENDING         // å‘é€ä¸­
  COMPLETED       // å·²å®Œæˆ
  FAILED          // å¤±è´¥
  CANCELLED       // å·²å–æ¶ˆ
}

enum CommunicationRecordStatus {
  PENDING         // å¾…å‘é€
  SENT            // å·²å‘é€
  DELIVERED       // å·²æŠ•é€’
  READ            // å·²è¯»
  FAILED          // å¤±è´¥
  CANCELLED       // å·²å–æ¶ˆ
}

// ===== Event Participant Interest System =====

// æ´»åŠ¨å‚ä¸è€…æ„Ÿå…´è¶£å…³ç³»è¡¨
model EventParticipantInterest {
  id                String    @id @default(cuid())
  eventId           String    // æ´»åŠ¨ID
  interestedUserId  String    // æ„Ÿå…´è¶£çš„ç”¨æˆ·IDï¼ˆä¸»åŠ¨æ–¹ï¼‰
  targetUserId      String    // è¢«æ„Ÿå…´è¶£çš„ç”¨æˆ·IDï¼ˆç›®æ ‡ç”¨æˆ·ï¼‰
  
  // ç¡®ä¿åŒæ–¹éƒ½æ˜¯æ´»åŠ¨å‚ä¸è€…çš„æ£€æŸ¥åœ¨åº”ç”¨å±‚å¤„ç†
  // è¿™é‡Œåªå­˜å‚¨å…³ç³»
  
  createdAt         DateTime  @default(now())
  
  // Relations
  event             Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  interestedUser    User      @relation("InterestedByUsers", fields: [interestedUserId], references: [id], onDelete: Cascade)
  targetUser        User      @relation("InterestedInUsers", fields: [targetUserId], references: [id], onDelete: Cascade)
  
  // ç¡®ä¿åŒä¸€æ´»åŠ¨ä¸­åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤å¯¹åŒä¸€ç›®æ ‡ç”¨æˆ·æ„Ÿå…´è¶£
  @@unique([eventId, interestedUserId, targetUserId])
  // ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
  @@index([eventId, interestedUserId])
  @@index([eventId, targetUserId])
  @@map("event_participant_interest")
}

// ===== Functional Role System =====

model FunctionalRole {
  id               String            @id @default(cuid())
  name             String
  description      String
  applicableScope  String?
  organizationId   String?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  organization     Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  assignments      RoleAssignment[]

  @@index([organizationId, isActive])
  @@unique([organizationId, name])
  @@map("functional_role")
}

model RoleAssignment {
  id               String          @id @default(cuid())
  userId           String
  organizationId   String
  functionalRoleId String
  startDate        DateTime
  endDate          DateTime?
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization     Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  functionalRole   FunctionalRole  @relation(fields: [functionalRoleId], references: [id], onDelete: Restrict)

  @@index([userId, isActive])
  @@index([organizationId, isActive])
  @@index([functionalRoleId, isActive])
  @@index([organizationId, functionalRoleId, startDate])
  @@map("role_assignment")
}

// ===== NFC Card Binding System =====

model NfcCard {
  id          String      @id @default(cuid()) // NFCå”¯ä¸€ID
  status      NfcStatus   @default(PENDING)    // NFCçŠ¶æ€
  boundUserId String?                          // ç»‘å®šçš„ç”¨æˆ·ID
  boundAt     DateTime?                        // ç»‘å®šæ—¶é—´
  createdBy   String                           // åˆ›å»ºè€…ï¼ˆç®¡ç†å‘˜IDï¼‰
  createdAt   DateTime    @default(now())

  // Relations
  boundUser   User?       @relation("BoundNfcCards", fields: [boundUserId], references: [id], onDelete: SetNull)
  creator     User        @relation("CreatedNfcCards", fields: [createdBy], references: [id])

  @@index([status])
  @@index([boundUserId])
  @@index([createdBy])
  @@map("nfc_card")
}

enum NfcStatus {
  PENDING     // æœªç»‘å®š
  BOUND       // å·²ç»‘å®š
}
